/*
	MIT License
 @author		Jason Huck - Core Five Labs
 @author		Simon Georget <simon (at) linea21 (dot) com>
 @copyright	Authors
*/
<<<<<<< HEAD
(function(e){function f(e){var t=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!t){throw new Error("XMLHttpRequest not supported")}t.open("HEAD",e,false);t.send(null);if(t.status==200){return true}return false}function v(t,n){if(t["File Type"]=="dir"&&n=="download")return false;if(typeof t["Capabilities"]=="undefined")return true;else return e.inArray(n,t["Capabilities"])>-1}function B(t){var n=t.attr("class").replace(/ /g,"_");if(n=="")return"itemOptions";if(!e("#"+n).length){var r=e("#itemOptions").clone().attr("id",n);if(!t.hasClass("cap_select"))e(".select",r).remove();if(!t.hasClass("cap_download"))e(".download",r).remove();if(!t.hasClass("cap_rename"))e(".rename",r).remove();if(!t.hasClass("cap_delete"))e(".delete",r).remove();e("#itemOptions").after(r)}return n}e.urlParam=function(e){var t=(new RegExp("[\\?&]"+e+"=([^&#]*)")).exec(window.location.href);if(t)return t[1];else return 0};var t=function(){var t=null;e.ajax({async:false,url:"./scripts/filemanager.config.js",dataType:"json",cache:false,success:function(e){t=e}});return t}();var n=t.options.fileConnector||"connectors/"+t.options.lang+"/filemanager."+t.options.lang;var r=new Array("select","download","rename","delete");if(e.urlParam("langCode")!=0&&f("scripts/languages/"+e.urlParam("langCode")+".js"))t.options.culture=e.urlParam("langCode");var s=[];e.ajax({url:"scripts/languages/"+t.options.culture+".js",async:false,dataType:"json",success:function(e){s=e}});e.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:false});var o=function(){var n=20;if(t.options.searchBox===true)n+=33;var r=e(window).height()-e("#uploader").height()-n;e("#splitter, #filetree, #fileinfo, .vsplitbar").height(r);var i=e("#splitter").width()-6-e("#filetree").width();e("#fileinfo").width(i)};var u=function(e,n){n=typeof n==="undefined"?true:false;if(t.options.showFullPath==false){if("function"===typeof displayPathDecorator){return displayPathDecorator(e.replace(fileRoot,"/"))}else{e=e.replace(fileRoot,"/");if(e.length>50&&n===true){var r=e.split("/");e="/"+r[1]+"/"+r[2]+"/(...)/"+r[r.length-2]+"/"}return e}}else{return e}};var a=function(t){if(t=="grid"){e("#grid").addClass("ON");e("#list").removeClass("ON")}else{e("#list").addClass("ON");e("#grid").removeClass("ON")}};var l=function(e,t,n){var r=String(n);for(i=0;i<e.length;i++){var s=RegExp(e[i],"g");var o=t[i];r=r.replace(s,o)}return r};var c=function(e){var n="";var r=new Array("Š","š","Đ","đ","Ž","ž","Č","č","Ć","ć","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ñ","Ò","Ó","Ô","Õ","Ö","Ő","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","â","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","ő","ø","ù","ú","û","ý","ý","þ","ÿ","Ŕ","ŕ"," ","'","/");var i=new Array("S","s","Dj","dj","Z","z","C","c","C","c","A","A","A","A","A","A","A","C","E","E","E","E","I","I","I","I","N","O","O","O","O","O","O","O","U","U","U","U","Y","B","Ss","a","a","a","a","a","a","a","c","e","e","e","e","i","i","i","i","o","n","o","o","o","o","o","o","o","u","u","u","y","y","b","y","R","r","_","_","");n=l(r,i,e);if(t.options.chars_only_latin){n=n.replace(/[^_a-zA-Z0-9]/g,"")}n=n.replace(/[_]+/g,"_");return n};var h=function(e){filename="";if(e.lastIndexOf(".")!=-1){filename=c(e.substr(0,e.lastIndexOf(".")));filename+="."+e.split(".").pop()}else{filename=c(e)}return filename};var p=function(e){var t=parseFloat(e);var n=parseFloat(1024);var r=0;var i=[s.bytes,s.kb,s.mb,s.gb];while(true){if(t<n){t=Math.round(t*100)/100;return t+i[r]}else{t/=n;r+=1}}};var d=function(t){e("#fileinfo").html("<h1>"+t+"</h1>");e("#newfile").attr("disabled","disabled");e("#upload").attr("disabled","disabled");e("#newfolder").attr("disabled","disabled")};var m=function(n){if(t.security.uploadPolicy=="DISALLOW_ALL"){if(e.inArray(y(n),t.security.uploadRestrictions)!=-1)return true}if(t.security.uploadPolicy=="ALLOW_ALL"){if(e.inArray(y(n),t.security.uploadRestrictions)==-1)return true}return false};var g=function(e,t){var n=e.replace(/^.*[\/\\]/g,"");if(typeof t=="string"&&n.substr(n.length-t.length)==t){n=n.substr(0,n.length-t.length)}return n};var y=function(e){if(e.split(".").length==1){return""}return e.split(".").pop().toLowerCase()};var b=function(e){if(e.lastIndexOf(".")!=-1){return e.substring(0,e.lastIndexOf("."))}else{return e}};var w=function(n){if(e.inArray(y(n),t.videos.videosExt)!=-1){return true}else{return false}};var E=function(n){if(e.inArray(y(n),t.audios.audiosExt)!=-1){return true}else{return false}};var S=function(n){var r="<video width="+t.videos.videosPlayerWidth+" height="+t.videos.videosPlayerHeight+' src="'+n["Path"]+'" controls="controls">';r+='<img src="'+n["Preview"]+'" />';r+="</video>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(r)};var x=function(t){var n='<audio src="'+t["Path"]+'" controls="controls">';n+='<img src="'+t["Preview"]+'" />';n+="</audio>";e("#fileinfo img").remove();e("#fileinfo #preview h1").before(n)};var T=function(t){e("#fileinfo").find("td:first-child").each(function(){var n=e(this).attr("title");var r=e("#filetree").find('a[rel="'+n+'"]').parent();if(typeof r.css("background-image")!=="undefined"){e(this).css("background-image",r.css("background-image"));window.clearInterval(t)}})};var N=function(t){e("#currentpath").val(t);e("#uploader h1").text(s.current_folder+u(t)).attr("title",u(t,false));e("#newfolder").unbind().click(function(){var t=s.default_foldername;var r=s.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+t+'" />';var i=function(r,i){if(r!=1)return false;var o=i.children("#fname").val();if(o!=""){t=c(o);var u=new Date;e.getJSON(n+"?mode=addfolder&path="+e("#currentpath").val()+"&name="+t+"&time="+u.getMilliseconds(),function(t){if(t["Code"]==0){P(t["Parent"],t["Name"]);I(t["Parent"]);e("#filetree").find('a[rel="'+t["Parent"]+'/"]').click().click()}else{e.prompt(t["Error"])}})}else{e.prompt(s.no_foldername)}};var o={};o[s.create_folder]=true;o[s.cancel]=false;e.prompt(r,{callback:i,buttons:o})})};var C=function(t){e("#fileinfo button").each(function(t){if(e(this).find("span").length==0)e(this).wrapInner("<span></span>")});if(!v(t,"select")){e("#fileinfo").find("button#select").hide()}else{e("#fileinfo").find("button#select").click(function(){L(t)}).show();if(window.opener||window.tinyMCEPopup){e("#preview img").attr("title",s.select);e("#preview img").click(function(){L(t)}).css("cursor","pointer")}}if(!v(t,"rename")){e("#fileinfo").find("button#rename").hide()}else{e("#fileinfo").find("button#rename").click(function(){var n=A(t);if(n.length)e("#fileinfo > h1").text(n)}).show()}if(!v(t,"delete")){e("#fileinfo").find("button#delete").hide()}else{e("#fileinfo").find("button#delete").click(function(){if(O(t))e("#fileinfo").html("<h1>"+s.select_from_left+"</h1>")}).show()}if(!v(t,"download")){e("#fileinfo").find("button#download").hide()}else{e("#fileinfo").find("button#download").click(function(){window.location=n+"?mode=download&path="+encodeURIComponent(t["Path"])}).show()}};var k=function(){e("#filetree").fileTree({root:fileRoot,datafunc:q,multiFolder:false,folderCallback:function(e){I(e)},expandedFolder:fullexpandedFolder,after:function(n){e("#filetree").find("li a").each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e(n).attr("rel");j(t,i)})});if(t.options.searchBox==true){e("#q").liveUpdate("#filetree ul").blur();e("#search span.q-inactive").html(s.search);e("#search a.q-reset").attr("title",s.search_reset)}}},function(e){F(e)})};var L=function(n){if(t.options.relPath!=false){var r=relPath+n["Path"]}else{var r=relPath+n["Path"]}r=r.replace("//","/");if(window.opener||window.tinyMCEPopup||e.urlParam("field_name")){if(window.tinyMCEPopup){var i=tinyMCEPopup.getWindowArg("window");i.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=r;if(typeof i.ImageDialog!="undefined"){if(i.ImageDialog.getImageData)i.ImageDialog.getImageData();if(i.ImageDialog.showPreviewImage)i.ImageDialog.showPreviewImage(r)}tinyMCEPopup.close();return}if(e.urlParam("field_name")){parent.document.getElementById(e.urlParam("field_name")).value=r;if(typeof top.tinyMCE!=="undefined"){top.tinyMCE.activeEditor.windowManager.close()}if(typeof parent.$.fn.colorbox!=="undefined"){parent.$.fn.colorbox.close()}}else if(e.urlParam("CKEditor")){window.opener.CKEDITOR.tools.callFunction(e.urlParam("CKEditorFuncNum"),r)}else{if(n["Properties"]["Width"]!=""){var o=r;var u=n["Properties"]["Width"];var a=n["Properties"]["Height"];window.opener.SetUrl(o,u,a)}else{window.opener.SetUrl(r)}}window.close()}else{e.prompt(s.fck_select_integration)}};var A=function(r){var i="";var o=s.new_filename+' : <input id="rname" name="rname" type="text" value="'+b(r["Filename"])+'" />';var u=function(o,u){if(o!=1)return false;rname=u.children("#rname").val();if(rname!=""){var a=h(rname);var f=y(r["Filename"]);if(f.length>0){a=a+"."+f}var l=r["Path"];var c=n+"?mode=rename&old="+r["Path"]+"&new="+a;e.ajax({type:"GET",url:c,dataType:"json",async:false,success:function(n){if(n["Code"]==0){var o=n["New Path"];var u=n["New Name"];_(l,o,u);var a=e("#preview h1").attr("title");if(typeof a!="undefined"&&a==l){e("#preview h1").text(u)}if(e("#fileinfo").data("view")=="grid"){e('#fileinfo img[alt="'+l+'"]').parent().next("p").text(u);e('#fileinfo img[alt="'+l+'"]').attr("alt",o)}else{e('#fileinfo td[title="'+l+'"]').text(u);e('#fileinfo td[title="'+l+'"]').attr("title",o)}e("#preview h1").html(u);r["Path"]=o;r["Filename"]=u;e("#fileinfo").find("button#rename, button#delete, button#download").unbind();C(r);if(t.options.showConfirmation)e.prompt(s.successful_rename)}else{e.prompt(n["Error"])}i=n["New Name"]}})}};var a={};a[s.rename]=true;a[s.cancel]=false;e.prompt(o,{callback:u,buttons:a});return i};var O=function(r){var i=false;var o=s.confirmation_delete;var a=function(o,a){if(o!=1)return false;var f=n+"?mode=delete&path="+encodeURIComponent(r["Path"]),l=r["Path"].split("/").reverse().slice(1).reverse().join("/")+"/";e.ajax({type:"GET",url:f,dataType:"json",async:false,success:function(n){if(n["Code"]==0){D(n["Path"]);var r=n["Path"].substring(0,n["Path"].length-1);r=r.substr(0,r.lastIndexOf("/")+1);e("#uploader h1").text(s.current_folder+u(r)).attr("title",u(r,false));i=true;if(t.options.showConfirmation)e.prompt(s.successful_delete);e("#filetree").find('a[rel="'+l+'/"]').click().click()}else{i=false;e.prompt(n["Error"])}}})};var f={};f[s.yes]=true;f[s.no]=false;e.prompt(o,{callback:a,buttons:f});return i};var M=function(n,r){var i=y(r);var o=e("#filetree").find('a[rel="'+n+'"]');var u=o.parent();var a='<li class="file ext_'+i+'"><a rel="'+n+r+'" href="#" class="">'+r+"</a></li>";if(!u.find("ul").size()){u=e("#filetree").find("ul.jqueryFileTree");u.prepend(a);k()}else{u.find("ul").prepend(a);o.click().click()}I(n);if(t.options.showConfirmation)e.prompt(s.successful_added_file)};var _=function(t,n,r){var i=e("#filetree").find('a[rel="'+t+'"]');var s=i.parent().parent().prev("a");i.attr("rel",n).text(r);s.click().click()};var D=function(t){e("#filetree").find('a[rel="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()});if(e("#fileinfo").data("view")=="grid"){e('#contents img[alt="'+t+'"]').parent().parent().fadeOut("slow",function(){e(this).remove()})}else{e("table#contents").find('td[title="'+t+'"]').parent().fadeOut("slow",function(){e(this).remove()})}if(e("#preview").length){I(t.substr(0,t.lastIndexOf("/")+1))}};var P=function(n,r){var i='<li class="directory collapsed"><a rel="'+n+r+'/" href="#">'+r+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>';var o=e("#filetree").find('a[rel="'+n+'"]');if(n!=fileRoot){o.next("ul").prepend(i).prev("a").click().click()}else{e("#filetree > ul").prepend(i);e("#filetree").find('li a[rel="'+n+r+'/"]').attr("class","cap_rename cap_delete").click(function(){I(n+r+"/")}).each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e(n).attr("rel");j(t,i)})})}if(t.options.showConfirmation)e.prompt(s.successful_added_folder)};var H=function(t){if(t.lastIndexOf("/")==t.length-1){I(t);e("#filetree").find('a[rel="'+t+'"]').click()}else{F(t)}};var j=function(t,r){var i=new Date;e.getJSON(n+"?mode=getinfo&path="+r+"&time="+i.getMilliseconds(),function(r){if(e("#fileinfo").data("view")=="grid"){var i=e("#fileinfo").find('img[alt="'+r["Path"]+'"]').parent()}else{var i=e("#fileinfo").find('td[title="'+r["Path"]+'"]').parent()}switch(t){case"select":L(r);break;case"download":window.location=n+"?mode=download&path="+r["Path"];break;case"rename":var s=A(r);break;case"delete":O(r);break}})};var F=function(r){var i=r.substr(0,r.lastIndexOf("/")+1);N(i);var o='<div id="preview"><img /><h1></h1><dl></dl></div>';o+='<form id="toolbar">';if(window.opener||window.tinyMCEPopup||e.urlParam("field_name"))o+='<button id="select" name="select" type="button" value="Select">'+s.select+"</button>";o+='<button id="download" name="download" type="button" value="Download">'+s.download+"</button>";if(t.options.browseOnly!=true)o+='<button id="rename" name="rename" type="button" value="Rename">'+s.rename+"</button>";if(t.options.browseOnly!=true)o+='<button id="delete" name="delete" type="button" value="Delete">'+s.del+"</button>";o+='<button id="parentfolder">'+s.parentfolder+"</button>";o+="</form>";e("#fileinfo").html(o);e("#parentfolder").click(function(){I(i)});var u=new Date;e.getJSON(n+"?mode=getinfo&path="+encodeURIComponent(r)+"&time="+u.getMilliseconds(),function(n){if(n["Code"]==0){e("#fileinfo").find("h1").text(n["Filename"]).attr("title",r);e("#fileinfo").find("img").attr("src",n["Preview"]);if(w(n["Filename"])&&t.videos.showVideoPlayer==true){S(n)}if(E(n["Filename"])&&t.audios.showAudioPlayer==true){x(n)}var i="";if(n["Properties"]["Width"]&&n["Properties"]["Width"]!="")i+="<dt>"+s.dimensions+"</dt><dd>"+n["Properties"]["Width"]+"x"+n["Properties"]["Height"]+"</dd>";if(n["Properties"]["Date Created"]&&n["Properties"]["Date Created"]!="")i+="<dt>"+s.created+"</dt><dd>"+n["Properties"]["Date Created"]+"</dd>";if(n["Properties"]["Date Modified"]&&n["Properties"]["Date Modified"]!="")i+="<dt>"+s.modified+"</dt><dd>"+n["Properties"]["Date Modified"]+"</dd>";if(n["Properties"]["Size"]||parseInt(n["Properties"]["Size"])==0)i+="<dt>"+s.size+"</dt><dd>"+p(n["Properties"]["Size"])+"</dd>";e("#fileinfo").find("dl").html(i);C(n)}else{e.prompt(n["Error"])}})};var I=function(i){N(i);e("#fileinfo").html('<img id="activity" src="images/wait30trans.gif" width="30" height="30" />');var o=new Date;var u=n+"?path="+encodeURIComponent(i)+"&mode=getfolder&showThumbs="+t.options.showThumbs+"&time="+o.getMilliseconds();if(e.urlParam("type"))u+="&type="+e.urlParam("type");e.getJSON(u,function(t){var n="";if(t.Code=="-1"){d(t.Error);return}if(t){if(e("#fileinfo").data("view")=="grid"){n+='<ul id="contents" class="grid">';for(key in t){var i=t[key]["Properties"];var o="";for(cap in r){if(v(t[key],r[cap])){o+=" cap_"+r[cap]}}var u=64;var a=i["Width"];if(a>1&&a<u)u=a;n+='<li class="'+o+'" title="'+t[key]["Path"]+'"><div class="clip"><img src="'+t[key]["Preview"]+'" width="'+u+'" alt="'+t[key]["Path"]+'" /></div><p>'+t[key]["Filename"]+"</p>";if(i["Width"]&&i["Width"]!="")n+='<span class="meta dimensions">'+i["Width"]+"x"+i["Height"]+"</span>";if(i["Size"]&&i["Size"]!="")n+='<span class="meta size">'+i["Size"]+"</span>";if(i["Date Created"]&&i["Date Created"]!="")n+='<span class="meta created">'+i["Date Created"]+"</span>";if(i["Date Modified"]&&i["Date Modified"]!="")n+='<span class="meta modified">'+i["Date Modified"]+"</span>";n+="</li>"}n+="</ul>"}else{n+='<table id="contents" class="list">';n+='<thead><tr><th class="headerSortDown"><span>'+s.name+"</span></th><th><span>"+s.dimensions+"</span></th><th><span>"+s.size+"</span></th><th><span>"+s.modified+"</span></th></tr></thead>";n+="<tbody>";for(key in t){var f=t[key]["Path"];var i=t[key]["Properties"];var o="";for(cap in r){if(v(t[key],r[cap])){o+=" cap_"+r[cap]}}n+='<tr class="'+o+'">';n+='<td title="'+f+'">'+t[key]["Filename"]+"</td>";if(i["Width"]&&i["Width"]!=""){n+="<td>"+i["Width"]+"x"+i["Height"]+"</td>"}else{n+="<td></td>"}if(i["Size"]&&i["Size"]!=""){n+='<td><abbr title="'+i["Size"]+'">'+p(i["Size"])+"</abbr></td>"}else{n+="<td></td>"}if(i["Date Modified"]&&i["Date Modified"]!=""){n+="<td>"+i["Date Modified"]+"</td>"}else{n+="<td></td>"}n+="</tr>"}n+="</tbody>";n+="</table>"}}else{n+="<h1>"+s.could_not_retrieve_folder+"</h1>"}e("#fileinfo").html(n);if(e("#fileinfo").data("view")=="grid"){e("#fileinfo").find("#contents li").click(function(){var t=e(this).find("img").attr("alt");H(t)}).each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e(n).find("img").attr("alt");j(t,i)})})}else{e("#fileinfo tbody tr").click(function(){var t=e("td:first-child",this).attr("title");H(t)}).each(function(){e(this).contextMenu({menu:B(e(this))},function(t,n,r){var i=e("td:first-child",n).attr("title");j(t,i)})});e("#fileinfo").find("table").tablesorter({textExtraction:function(t){if(e(t).find("abbr").size()){return e(t).find("abbr").attr("title")}else{return t.innerHTML}}});var l=setInterval(function(){T(l)},300)}})};var q=function(i,o){var u=new Date;var a=n+"?path="+encodeURIComponent(i)+"&mode=getfolder&showThumbs="+t.options.showThumbs+"&time="+u.getMilliseconds();if(e.urlParam("type"))a+="&type="+e.urlParam("type");e.getJSON(a,function(e){var n="";if(e.Code=="-1"){d(e.Error);return}if(e){n+='<ul class="jqueryFileTree" style="display: none;">';for(key in e){var i="";for(cap in r){if(v(e[key],r[cap])){i+=" cap_"+r[cap]}}if(e[key]["File Type"]=="dir"){n+='<li class="directory collapsed"><a href="#" class="'+i+'" rel="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}else{if(t.options.listFiles){n+='<li class="file ext_'+e[key]["File Type"].toLowerCase()+'"><a href="#" class="'+i+'" rel="'+e[key]["Path"]+'">'+e[key]["Filename"]+"</a></li>"}}}n+="</ul>"}else{n+="<h1>"+s.could_not_retrieve_folder+"</h1>"}o(n)})};e(function(){if(t.extras.extra_js){for(var r=0;r<t.extras.extra_js.length;r++){e.ajax({url:t.extras.extra_js[r],dataType:"script",async:t.extras.extra_js_async})}}if(!t.options.fileRoot){fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/"}else{if(!t.options.serverRoot){fileRoot=t.options.fileRoot}else{fileRoot="/"+t.options.fileRoot}fileRoot=fileRoot.replace(/\/\//g,"/")}if(t.options.relPath===false){relPath=window.location.protocol+"//"+window.location.host}else{relPath=t.options.relPath}if(e.urlParam("expandedFolder")!=0){expandedFolder=e.urlParam("expandedFolder");fullexpandedFolder=fileRoot+expandedFolder}else{expandedFolder="";fullexpandedFolder=null}if(t.options.autoload==true){e("#upload").append(s.upload);e("#newfolder").append(s.new_folder);e("#grid").attr("title",s.grid_view);e("#list").attr("title",s.list_view);e("#fileinfo h1").append(s.select_from_left);e('#itemOptions a[href$="#select"]').append(s.select);e('#itemOptions a[href$="#download"]').append(s.download);e('#itemOptions a[href$="#rename"]').append(s.rename);e('#itemOptions a[href$="#delete"]').append(s.del)}e("#browse").append("+");e("#browse").attr("title",s.browse);e("#newfile").change(function(){e("#filepath").val(e(this).val().replace(/.+[\\\/]/,""))});if(t.options.searchBox===true){e.getScript("./scripts/filemanager.liveSearch.min.js")}else{e("#search").remove()}e("button").wrapInner("<span></span>");e("#fileinfo").data("view",t.options.defaultViewMode);a(t.options.defaultViewMode);e("#home").click(function(){var t=e("#fileinfo").data("view");e("#fileinfo").data("view",t);e("#filetree>ul>li.expanded>a").trigger("click");I(fileRoot)});e("#grid").click(function(){a("grid");e("#fileinfo").data("view","grid");I(e("#currentpath").val())});e("#list").click(function(){a("list");e("#fileinfo").data("view","list");I(e("#currentpath").val())});N(fileRoot);e("#uploader").attr("action",n);e("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(n,r,i){if(e("#newfile",r).val()==""){return false}if(!m(e("#newfile",r).val())){var o="<p>"+s.INVALID_FILE_TYPE+"</p>";if(t.security.uploadPolicy=="DISALLOW_ALL"){o+="<p>"+s.ALLOWED_FILE_TYPE+t.security.uploadRestrictions.join(", ")+".</p>"}if(t.security.uploadPolicy=="ALLOW_ALL"){o+="<p>"+s.DISALLOWED_FILE_TYPE+t.security.uploadRestrictions.join(", ")+".</p>"}e("#filepath").val("");e.prompt(o);return false}e("#upload").attr("disabled",true);e("#upload span").addClass("loading").text(s.loading_data);if(e.urlParam("type").toString().toLowerCase()=="images"){var u=e("#newfile",r).val().toLowerCase().split(".");for(key in t.images.imagesExt){if(t.images.imagesExt[key]==u[u.length-1]){return true}}e.prompt(s.UPLOAD_IMAGES_ONLY);e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(s.upload);return false}if(typeof FileReader!=="undefined"&&typeof t.upload.fileSizeLimit!="auto"){var a=e("#newfile",r).get(0).files[0].size;if(a>t.upload.fileSizeLimit*1024*1024){e.prompt("<p>"+s.file_too_big+"</p><p>"+s.file_size_limit+t.upload.fileSizeLimit+" "+s.mb+".</p>");e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(s.upload);return false}}},error:function(t,n,r){e("#upload").removeAttr("disabled").find("span").removeClass("loading").text(s.upload);e.prompt("Error uploading file")},success:function(t){var n=jQuery.parseJSON(e("#uploadresponse").find("textarea").text());if(n["Code"]==0){M(n["Path"],n["Name"]);e("#filepath, #newfile").val("");e("#filetree").find('a[rel="'+n["Path"]+'/"]').click().click()}else{e.prompt(n["Error"])}e("#upload").removeAttr("disabled");e("#upload span").removeClass("loading").text(s.upload);e("#filepath").val("")}});k();if(!(window.opener||window.tinyMCEPopup||e.urlParam("field_name")))e('#itemOptions a[href$="#select"]').remove();if(t.options.browseOnly==true){e("#file-input-container").remove();e("#upload").remove();e("#newfolder").remove();e("#toolbar").remove("#rename");e(".contextMenu .rename").remove();e(".contextMenu .delete").remove()}o();e(window).resize(o);e("#splitter").splitter({sizeLeft:200});H(fileRoot+expandedFolder)});var R=document.documentElement;R.setAttribute("data-useragent",navigator.userAgent)})(jQuery)
=======
(function(a){function H(a){var c=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!c)throw Error("XMLHttpRequest not supported");c.open("HEAD",a,!1);c.send(null);return 200==c.status?!0:!1}function q(b,c){return"dir"==b["File Type"]&&"replace"==c?!1:"dir"==b["File Type"]&&"download"==c?1==d.security.allowFolderDownload?!0:!1:"undefined"==typeof b.Capabilities?!0:-1<a.inArray(c,b.Capabilities)}function x(b){var c=b.attr("class").replace(/ /g,"_");if(""==c)return"itemOptions";
if(!a("#"+c).length){var d=a("#itemOptions").clone().attr("id",c);b.hasClass("cap_select")||a(".select",d).remove();b.hasClass("cap_download")||a(".download",d).remove();b.hasClass("cap_rename")||a(".rename",d).remove();b.hasClass("cap_move")||a(".move",d).remove();a(".replace",d).remove();b.hasClass("cap_delete")||a(".delete",d).remove();a("#itemOptions").after(d)}return c}a.urlParam=function(a){return(a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(window.location.href))?a[1]:0};var t=function(b){var c=
null;"user"==("undefined"===typeof b?"user":b)?0!=a.urlParam("config")?(b="./scripts/"+a.urlParam("config"),userconfig=a.urlParam("config")):(b="./scripts/filemanager.config.json",userconfig="filemanager.config.json"):b="./scripts/filemanager.config.default.json";a.ajax({async:!1,url:b,dataType:"json",cache:!1,success:function(a){c=a}});return c},Q=t("default"),d=t();null!==d&&delete d.version;d=a.extend({},Q,d);if(d.options.logger)var R=(new Date).getTime();HEAD_included_files=[];loadCSS=function(b){if(-1==
a.inArray(b,HEAD_included_files)){var c=a("<link rel='stylesheet' type='text/css' href='"+b+"'>");a("head").append(c);HEAD_included_files.push(b)}};loadJS=function(b){if(-1==a.inArray(b,HEAD_included_files)){var c=a("<script type='text/javascript' src='"+b+"'>");a("head").append(c);HEAD_included_files.push(b)}};smartPath=function(a,c){var f=a.split("/"),f="/"+f[f.length-2]+"/",e=c.indexOf(f);rvalue=-1==e?a+c:a+c.substring(e+f.length);d.options.logger&&console.log("url : "+a+" - path : "+c+" - separator : "+
f+" -  pos : "+e+" - returned value : "+rvalue);return rvalue};var k=d.options.fileConnector||"connectors/"+d.options.lang+"/filemanager."+d.options.lang,l=d.options.capabilities||"select download rename move delete replace".split(" ");0!=a.urlParam("langCode")&&(H("scripts/languages/"+a.urlParam("langCode")+".js")?d.options.culture=a.urlParam("langCode"):(t=a.urlParam("langCode").substring(0,2),H("scripts/languages/"+t+".js")&&(d.options.culture=t)));var f=[];a.ajax({url:"scripts/languages/"+d.options.culture+
".js",async:!1,dataType:"json",success:function(a){f=a}});a.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:!1});var y=function(){var b=53,c=a("#uploader");a.urlParam("CKEditorCleanUpFuncNum")&&(b+=60);b=a(window).height()-c.height()-c.offset().top-b;a("#splitter, #filetree, #fileinfo, .vsplitbar").height(b);b=a("#splitter").width()-a("div.vsplitbar").width()-a("#filetree").width();a("#fileinfo").width(b)},z=function(a,c){c="undefined"===typeof c?!0:!1;if(0==d.options.showFullPath){if("function"===
typeof displayPathDecorator)return displayPathDecorator(a.replace(fileRoot,"/"));a=a.replace(fileRoot,"/");if(50<a.length&&!0===c){var f=a.split("/");a="/"+f[1]+"/"+f[2]+"/(...)/"+f[f.length-2]+"/"}}return a},B=function(b){"grid"==b?(a("#grid").addClass("ON"),a("#list").removeClass("ON")):(a("#list").addClass("ON"),a("#grid").removeClass("ON"))},C=function(a){var c;c="\u0160\u0161\u0110\u0111\u017d\u017e\u010c\u010d\u0106\u0107\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00c6\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u0150\u00d8\u00d9\u00da\u00db\u00dc\u00dd\u00de\u00df\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00e6\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f0\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u0151\u00f8\u00f9\u00fa\u00fb\u00fc\u00fd\u00fd\u00fe\u00ff\u0154\u0155 '/".split("");
var f="S s Dj dj Z z C c C c A A A A A A A C E E E E I I I I N O O O O O O O U U U U Y B Ss a a a a a a a c e e e e i i i i o n o o o o o o o u u u u y y b y R r _ _ ".split(" ");a=String(a);for(i=0;i<c.length;i++)a=a.replace(RegExp(c[i],"g"),f[i]);c=a;d.options.chars_only_latin&&(c=c.replace(/[^_a-zA-Z0-9]/g,""));c=c.replace(/[_]+/g,"_");""==c&&(c="unsupportedCharsReplacement");return c},S=function(a){filename="";-1!=a.lastIndexOf(".")?(filename=C(a.substr(0,a.lastIndexOf("."))),filename+="."+a.split(".").pop()):
filename=C(a);return filename},I=function(a){a=parseFloat(a);for(var c=0,d=[f.bytes,f.kb,f.mb,f.gb];;){if(1024>a)return a=Math.round(100*a)/100,a+d[c];a/=1024;c+=1}},J=function(b){a("#fileinfo").html("<h1>"+b+"</h1>");a("#newfile").attr("disabled","disabled");a("#upload").attr("disabled","disabled");a("#newfolder").attr("disabled","disabled")},K=function(b){b=p(b);return""==b&&1==d.security.allowNoExtension||"DISALLOW_ALL"==d.security.uploadPolicy&&-1!=a.inArray(b,d.security.uploadRestrictions)||
"ALLOW_ALL"==d.security.uploadPolicy&&-1==a.inArray(b,d.security.uploadRestrictions)?!0:!1},p=function(a){return 1==a.split(".").length?"":a.split(".").pop().toLowerCase()},T=function(a){return-1!=a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):a},U=function(b){var c="<video width="+d.videos.videosPlayerWidth+" height="+d.videos.videosPlayerHeight+' src="'+b.Path+'" controls="controls">',c=c+('<img src="'+b.Preview+'" />'),c=c+"</video>";a("#fileinfo img").remove();a("#fileinfo #preview #main-title").before(c)},
V=function(b){var c='<audio src="'+b.Path+'" controls="controls">',c=c+('<img src="'+b.Preview+'" />'),c=c+"</audio>";a("#fileinfo img").remove();a("#fileinfo #preview #main-title").before(c)},W=function(b){b='<iframe id="fm-pdf-viewer" src = "scripts/ViewerJS/index.html#'+b.Path+'" width="'+d.pdfs.pdfsReaderWidth+'" height="'+d.pdfs.pdfsReaderHeight+'" allowfullscreen webkitallowfullscreen></iframe>';a("#fileinfo img").remove();a("#fileinfo #preview #main-title").before(b)},X=function(b){a("#fileinfo").find("td:first-child").each(function(){var c=
a(this).attr("data-path"),c=a("#filetree").find('a[data-path="'+c+'"]').parent();"undefined"!==typeof c.css("background-image")&&(a(this).css("background-image",c.css("background-image")),window.clearInterval(b))})},D=function(b){a("#currentpath").val(b);a("#uploader h1").text(f.current_folder+z(b)).attr("title",z(b,!1)).attr("data-path",b);a("#newfolder").unbind().click(function(){var b=f.default_foldername,d=f.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+b+'" />',e=
{};e[f.create_folder]=!0;e[f.cancel]=!1;a.prompt(d,{callback:function(e,d){if(1!=e)return!1;var g=d.children("#fname").val();""!=g?(b=C(g),g=new Date,a.getJSON(k+"?mode=addfolder&path="+a("#currentpath").val()+"&config="+userconfig+"&name="+encodeURIComponent(b)+"&time="+g.getMilliseconds(),function(b){0==b.Code?(Y(b.Parent,b.Name),m(b.Parent),a("#filetree").find('a[data-path="'+b.Parent+'/"]').click().click()):a.prompt(b.Error)})):a.prompt(f.no_foldername)},buttons:e})})},P=function(b){a("#fileinfo button").each(function(b){0==
a(this).find("span").length&&a(this).wrapInner("<span></span>")});if(q(b,"select")){if(a("#fileinfo").find("button#select").click(function(){w(b)}).show(),window.opener||window.tinyMCEPopup)a("#preview img").attr("title",f.select),a("#preview img").click(function(){w(b)}).css("cursor","pointer")}else a("#fileinfo").find("button#select").hide();q(b,"rename")?a("#fileinfo").find("button#rename").click(function(){var c=L(b);c.length&&a("#fileinfo > h1").text(c)}).show():a("#fileinfo").find("button#rename").hide();
q(b,"move")?a("#fileinfo").find("button#move").click(function(){var c=M(b);c.length&&a("#fileinfo > h1").text(c)}).show():a("#fileinfo").find("button#move").hide();q(b,"replace")?a("#fileinfo").find("button#replace").click(function(){N(b)}).show():a("#fileinfo").find("button#replace").hide();q(b,"delete")?a("#fileinfo").find("button#delete").click(function(){O(b)&&a("#fileinfo").html("<h1>"+f.select_from_left+"</h1>")}).show():a("#fileinfo").find("button#delete").hide();q(b,"download")?a("#fileinfo").find("button#download").click(function(){window.location=
k+"?mode=download&path="+encodeURIComponent(b.Path)+"&config="+userconfig}).show():a("#fileinfo").find("button#download").hide()},v=function(){var b=0<a("#filetree .mCSB_container").length?"#filetree .mCSB_container":"#filetree";a(b).fileTree({root:fileRoot,datafunc:Z,multiFolder:!1,folderCallback:function(a){m(a)},expandedFolder:fullexpandedFolder,after:function(b){a("#filetree").find("li a").each(function(){a(this).contextMenu({menu:x(a(this))},function(b,e,d){e=a(e).attr("data-path");A(b,e)})});
1==d.options.searchBox&&(a("#q").liveUpdate("#filetree ul").blur(),a("#search span.q-inactive").html(f.search),a("#search a.q-reset").attr("title",f.search_reset))}},function(a){E(a)})},w=function(b){var c=!1!==d.options.baseUrl?smartPath(baseUrl,b.Path.replace(fileRoot,"")):baseUrl+b.Path;window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a.urlParam("CKEditorCleanUpFuncNum")||a.urlParam("CKEditor")?window.tinyMCEPopup?(b=tinyMCEPopup.getWindowArg("window"),b.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=
c,"undefined"!=typeof b.ImageDialog&&(b.ImageDialog.getImageData&&b.ImageDialog.getImageData(),b.ImageDialog.showPreviewImage&&b.ImageDialog.showPreviewImage(c)),tinyMCEPopup.close()):(a.urlParam("field_name")?(parent.document.getElementById(a.urlParam("field_name")).value=c,"undefined"!==typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!==typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()):a.urlParam("CKEditor")?window.opener?window.opener.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),
c):(parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),c),parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))):""!=b.Properties.Width?window.opener.SetUrl(c,b.Properties.Width,b.Properties.Height):window.opener.SetUrl(c),window.opener&&window.close()):a.prompt(f.fck_select_integration)},L=function(b){var c="",g=d.security.allowChangeExtensions?b.Filename:T(b.Filename),g=f.new_filename+' : <input id="rname" name="rname" type="text" value="'+g+'" />',e={};e[f.rename]=
!0;e[f.cancel]=!1;a.prompt(g,{callback:function(e,g){if(1!=e)return!1;rname=g.children("#rname").val();if(""!=rname){var h=rname;if(!d.security.allowChangeExtensions){var h=S(rname),n=p(b.Filename);0<n.length&&(h=h+"."+n)}if("/"!=b.Path.charAt(b.Path.length-1)&&!K(h))return h="<p>"+f.INVALID_FILE_TYPE+"</p>","DISALLOW_ALL"==d.security.uploadPolicy&&(h+="<p>"+f.ALLOWED_FILE_TYPE+d.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==d.security.uploadPolicy&&(h+="<p>"+f.DISALLOWED_FILE_TYPE+
d.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),a.prompt(h),!1;h=k+"?mode=rename&old="+encodeURIComponent(b.Path)+"&new="+encodeURIComponent(h)+"&config="+userconfig;a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(e){if(0==e.Code){var g=e["New Path"],u=e["New Name"],h=e["Old Path"],r=a("#filetree").find('a[data-path="'+h+'"]'),n=r.parent().parent().prev("a");r.attr("data-path",g).text(u);0==n.length?v():n.click().click();r=a("#preview h1").attr("title");
"undefined"!=typeof r&&r==h&&a("#preview h1").text(u);"grid"==a("#fileinfo").data("view")?(a('#fileinfo img[data-path="'+h+'"]').parent().next("p").text(u),a('#fileinfo img[data-path="'+h+'"]').attr("data-path",g)):(a('#fileinfo td[data-path="'+h+'"]').text(u),a('#fileinfo td[data-path="'+h+'"]').attr("data-path",g));a("#preview h1").html(u);b.Path=g;b.Filename=u;a("#fileinfo").find("button#rename, button#delete, button#download").unbind();P(b);d.options.showConfirmation&&a.prompt(f.successful_rename)}else a.prompt(e.Error);
c=e["New Name"]}})}},buttons:e});return c},N=function(b){a("#fileR").bind("change",function(){a(this).closest("form#toolbar").submit()});a("#toolbar").attr("action",k);a("#toolbar").attr("method","post");a("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(c,g,e){c=a("#fileR",g).val();if(""==c)return!1;if(p(c)!=b["File Type"])return a.prompt(f.ERROR_REPLACING_FILE+" ."+p(b.Filename)),!1;a("#replace").attr("disabled",!0);a("#upload span").addClass("loading").text(f.loading_data);
if("undefined"!==typeof FileReader&&"auto"!=typeof d.upload.fileSizeLimit&&a("#fileR",g).get(0).files[0].size>1048576*d.upload.fileSizeLimit)return a.prompt("<p>"+f.file_too_big+"</p><p>"+f.file_size_limit+d.upload.fileSizeLimit+" "+f.mb+".</p>"),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload),!1},error:function(b,d,e){a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);a.prompt(f.ERROR_UPLOADING_FILE)},success:function(b){b=
jQuery.parseJSON(a("#uploadresponse").find("textarea").text());0==b.Code?(b=b.Path+"/"+b.Name,E(b),a("#preview").find("img").hide().fadeIn("slow"),a("ul.jqueryFileTree").find('li a[data-path="'+b+'"]').parent().hide().fadeIn("slow"),d.options.showConfirmation&&a.prompt(f.successful_replace)):a.prompt(b.Error);a("#replace").removeAttr("disabled");a("#upload span").removeClass("loading").text(f.upload)}});a("#newfilepath").val(b.Path);a("#fileR").click()},M=function(b){var c="",g=f.move+' : <input id="rname" name="rname" type="text" value="" />',
g=g+('<div class="prompt-info">'+f.help_move+"</div>"),e={};e[f.move]=!0;e[f.cancel]=!1;a.prompt(g,{callback:function(e,g){if(1!=e)return!1;rname=g.children("#rname").val();if(""!=rname){var h=rname,h=k+"?mode=move&old="+encodeURIComponent(b.Path)+"&new="+encodeURIComponent(h)+"&root="+encodeURIComponent(fileRoot)+"&config="+userconfig;a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(b){if(0==b.Code){var e=b["New Path"],g=b["New Name"];fullexpandedFolder=e;v();m(e);d.options.showConfirmation&&
a.prompt(f.successful_moved)}else a.prompt(b.Error);c=e+g}})}},buttons:e});return c},O=function(b){var c=!1,g=f.confirmation_delete,e={};e[f.yes]=!0;e[f.no]=!1;a.prompt(g,{callback:function(e,g){if(1!=e)return!1;var h=new Date,h=k+"?mode=delete&path="+encodeURIComponent(b.Path)+"&time="+h.getMilliseconds()+"&config="+userconfig,n=b.Path.split("/").reverse().slice(1).reverse().join("/")+"/";a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(b){0==b.Code?(aa(b.Path),b=b.Path.substring(0,
b.Path.length-1),b=b.substr(0,b.lastIndexOf("/")+1),a("#uploader h1").text(f.current_folder+z(b)).attr("title",z(b,!1)).attr("data-path",b),c=!0,d.options.showConfirmation&&a.prompt(f.successful_delete),a("#filetree").find('a[data-path="'+n+'/"]').click().click()):(c=!1,a.prompt(b.Error))}})},buttons:e});return c},ba=function(b){isEdited=!1;a("#fileinfo").find("div#tools").append(' <a id="edit-file" href="#" title="'+f.edit+'"><span>'+f.edit+"</span></a>");a("#edit-file").click(function(){a(this).hide();
var c=new Date,c=k+"?mode=editfile&path="+encodeURIComponent(b.Path)+"&config="+userconfig+"&time="+c.getMilliseconds();a.ajax({type:"GET",url:c,dataType:"json",async:!1,success:function(c){0==c.Code?(c='<form id="edit-form">'+('<textarea id="edit-content" name="content">'+c.Content+"</textarea>"),c=c+'<input type="hidden" name="mode" value="savefile" />'+('<input type="hidden" name="path" value="'+b.Path+'" />'),c+='<button id="edit-cancel" class="edition" type="button">'+f.quit_editor+"</button>",
c+='<button id="edit-save" class="edition" type="button">'+f.save+"</button>",c+="</form>",a("#preview").find("img").hide(),a("#preview").prepend(c).hide().fadeIn(),a("#edit-cancel").click(function(){a("#preview").find("form#edit-form").hide();a("#preview").find("img").fadeIn();a("#edit-file").show()}),a("#edit-save").click(function(){var b=codeMirrorEditor.getValue();a("textarea#edit-content").val(b);b=a("#edit-form").serializeArray();a.ajax({type:"POST",url:k+"?config="+userconfig,dataType:"json",
data:b,async:!1,success:function(b){0==b.Code?(isEdited=!0,a.prompt(f.successful_edit)):(isEdited=!1,a.prompt(b.Error))}})}),codeMirrorEditor=instantiateCodeMirror(p(b.Path),d)):(isEdited=!1,a.prompt(c.Error),a(this).show())}})});return isEdited},aa=function(b){a("#filetree").find('a[data-path="'+b+'"]').parent().fadeOut("slow",function(){a(this).remove()});if(a("#uploader h1").attr("data-path")==b){var d=b.split("/").slice(0,length-2).join("/")+"/";m(d)}"grid"==a("#fileinfo").data("view")?a('#contents img[data-path="'+
b+'"]').parent().parent().fadeOut("slow",function(){a(this).remove()}):a("table#contents").find('td[data-path="'+b+'"]').parent().fadeOut("slow",function(){a(this).remove()});a("#preview").length&&m(b.substr(0,b.lastIndexOf("/")+1))},Y=function(b,c){var g='<li class="directory collapsed"><a data-path="'+b+c+'/" href="#">'+c+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>',e=a("#filetree").find('a[data-path="'+b+'"]');b!=fileRoot?e.next("ul").prepend(g).prev("a").click().click():
(a("#filetree ul.jqueryFileTree").prepend(g),a("#filetree").find('li a[data-path="'+b+c+'/"]').attr("class","cap_rename cap_delete").click(function(){m(b+c+"/")}).each(function(){a(this).contextMenu({menu:x(a(this))},function(b,e,d){e=a(e).attr("data-path");A(b,e)})}));d.options.showConfirmation&&a.prompt(f.successful_added_folder)},G=function(b){b.lastIndexOf("/")==b.length-1?(m(b),a("#filetree").find('a[data-path="'+b+'"]').click()):E(b)},A=function(b,d){var f=new Date;a.getJSON(k+"?mode=getinfo&path="+
encodeURIComponent(d)+"&config="+userconfig+"&time="+f.getMilliseconds(),function(e){"grid"==a("#fileinfo").data("view")?a("#fileinfo").find('img[data-path="'+e.Path+'"]').parent():a("#fileinfo").find('td[data-path="'+e.Path+'"]').parent();switch(b){case "select":w(e);break;case "download":window.location=k+"?mode=download&path="+e.Path+"&config="+userconfig+"&time="+f.getMilliseconds();break;case "rename":L(e);break;case "replace":N(e);break;case "move":M(e);break;case "delete":O(e)}})},E=function(b){a(".contextMenu").hide();
var c=b.substr(0,b.lastIndexOf("/")+1);D(c);var g;g='<div id="preview"><img /><div id="main-title"><h1></h1><div id="tools"></div></div><dl></dl></div><form id="toolbar">'+('<button id="parentfolder">'+f.parentfolder+"</button>");-1!=a.inArray("select",l)&&(a.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||a.urlParam("field_name"))&&(g+='<button id="select" name="select" type="button" value="Select">'+f.select+"</button>");-1!=a.inArray("download",l)&&(g+='<button id="download" name="download" type="button" value="Download">'+
f.download+"</button>");-1!=a.inArray("rename",l)&&1!=d.options.browseOnly&&(g+='<button id="rename" name="rename" type="button" value="Rename">'+f.rename+"</button>");-1!=a.inArray("move",l)&&1!=d.options.browseOnly&&(g+='<button id="move" name="move" type="button" value="Move">'+f.move+"</button>");-1!=a.inArray("delete",l)&&1!=d.options.browseOnly&&(g+='<button id="delete" name="delete" type="button" value="Delete">'+f.del+"</button>");-1!=a.inArray("replace",l)&&1!=d.options.browseOnly&&(g+='<button id="replace" name="replace" type="button" value="Replace">'+
f.replace+"</button>",g+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div><input id="mode" name="mode" type="hidden" value="replace" /> <input id="newfilepath" name="newfilepath" type="hidden" />');g+="</form>";0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(g):a("#fileinfo").html(g);a("#parentfolder").click(function(){m(c)});g=new Date;a.getJSON(k+"?mode=getinfo&path="+encodeURIComponent(b)+"&config="+userconfig+"&time="+g.getMilliseconds(),
function(e){if(0==e.Code){a("#fileinfo").find("h1").text(e.Filename).attr("title",b);a("#fileinfo").find("img").attr("src",e.Preview);var c;c=-1!=a.inArray(p(e.Filename),d.videos.videosExt)?!0:!1;c&&1==d.videos.showVideoPlayer&&U(e);c=-1!=a.inArray(p(e.Filename),d.audios.audiosExt)?!0:!1;c&&1==d.audios.showAudioPlayer&&V(e);c=-1!=a.inArray(p(e.Filename),d.pdfs.pdfsExt)?!0:!1;c&&1==d.pdfs.showPdfReader&&W(e);c=-1!=a.inArray(p(e.Filename),d.edit.editExt)?!0:!1;c&&1==d.edit.enabled&&0==e.Protected&&
ba(e);c=new Date;var g=!1!==d.options.baseUrl?smartPath(baseUrl,e.Path.replace(fileRoot,"")):baseUrl+e.Path;0==e.Protected&&(a("#fileinfo").find("div#tools").append(' <a id="copy-button" data-clipboard-text="'+g+'" title="'+f.copy_to_clipboard+'" href="#"><span>'+f.copy_to_clipboard+"</span></a>"),loadJS("./scripts/zeroclipboard/copy.js?d"+c.getMilliseconds()),a("#copy-button").click(function(){a("#fileinfo").find("div#tools").append('<span id="copied">'+f.copied+"</span>");a("#copied").delay(500).fadeOut(1E3,
function(){a(this).remove()})}));c="";e.Properties.Width&&""!=e.Properties.Width&&(c+="<dt>"+f.dimensions+"</dt><dd>"+e.Properties.Width+"x"+e.Properties.Height+"</dd>");e.Properties["Date Created"]&&""!=e.Properties["Date Created"]&&(c+="<dt>"+f.created+"</dt><dd>"+e.Properties["Date Created"]+"</dd>");e.Properties["Date Modified"]&&""!=e.Properties["Date Modified"]&&(c+="<dt>"+f.modified+"</dt><dd>"+e.Properties["Date Modified"]+"</dd>");if(e.Properties.Size||0==parseInt(e.Properties.Size))c+="<dt>"+
f.size+"</dt><dd>"+I(e.Properties.Size)+"</dd>";a("#fileinfo").find("dl").html(c);P(e)}else a.prompt(e.Error)})},m=function(b){D(b);var c='<img id="activity" src="themes/'+d.options.theme+'/images/wait30trans.gif" width="30" height="30" />';0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(c):a("#fileinfo").html(c);a("#loading-wrap").fadeOut(800);c=new Date;b=k+"?path="+encodeURIComponent(b)+"&config="+userconfig+"&mode=getfolder&showThumbs="+d.options.showThumbs+"&time="+
c.getMilliseconds();a.urlParam("type")&&(b+="&type="+a.urlParam("type"));a.getJSON(b,function(b){var e="";if("-1"==b.Code)J(b.Error);else{y();if(b){var c=0,r=0;if("grid"==a("#fileinfo").data("view")){e+='<ul id="contents" class="grid">';for(key in b){c++;var h=b[key].Properties,n="";for(cap in l)q(b[key],l[cap])&&(n+=" cap_"+l[cap]);var F=64,k=h.Width;1<k&&k<F&&(F=k);d.options.showTitleAttr?title=' title="'+b[key].Path+'"':title="";e+='<li class="'+n+'"'+title+'"><div class="clip"><img src="'+b[key].Preview+
'" width="'+F+'" alt="'+b[key].Path+'" data-path="'+b[key].Path+'" /></div><p>'+b[key].Filename+"</p>";h.Width&&""!=h.Width&&(e+='<span class="meta dimensions">'+h.Width+"x"+h.Height+"</span>");h.Size&&""!=h.Size&&(e+='<span class="meta size">'+h.Size+"</span>");h.Size&&""!=h.Size&&(r+=h.Size);h["Date Created"]&&""!=h["Date Created"]&&(e+='<span class="meta created">'+h["Date Created"]+"</span>");h["Date Modified"]&&""!=h["Date Modified"]&&(e+='<span class="meta modified">'+h["Date Modified"]+"</span>");
e+="</li>"}e+="</ul>"}else{e=e+'<table id="contents" class="list">'+('<thead><tr><th class="headerSortDown"><span>'+f.name+"</span></th><th><span>"+f.dimensions+"</span></th><th><span>"+f.size+"</span></th><th><span>"+f.modified+"</span></th></tr></thead>");e+="<tbody>";for(key in b){c++;h=b[key].Properties;n="";d.options.showTitleAttr?title=' title="'+b[key].Path+'"':title="";for(cap in l)q(b[key],l[cap])&&(n+=" cap_"+l[cap]);e+='<tr class="'+n+'">';e+='<td data-path="'+b[key].Path+'"'+title+'">'+
b[key].Filename+"</td>";e=h.Width&&""!=h.Width?e+("<td>"+h.Width+"x"+h.Height+"</td>"):e+"<td></td>";h.Size&&""!=h.Size?(e+='<td><abbr title="'+h.Size+'">'+I(h.Size)+"</abbr></td>",r+=h.Size):e+="<td></td>";e=h["Date Modified"]&&""!=h["Date Modified"]?e+("<td>"+h["Date Modified"]+"</td>"):e+"<td></td>";e+="</tr>"}e+="</tbody></table>"}}else e+="<h1>"+f.could_not_retrieve_folder+"</h1>";0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(e):a("#fileinfo").html(e);a("#items-counter").text(c);
a("#items-size").text(Math.round(r/1024/1024*100)/100);if("grid"==a("#fileinfo").data("view"))a("#fileinfo").find("#contents li").click(function(){var e=a(this).find("img").attr("data-path");d.options.quickSelect&&"dir"!=b[e]["File Type"]&&a(this).hasClass("cap_select")?w(b[e]):G(e)}).each(function(){a(this).contextMenu({menu:x(a(this))},function(b,e,c){e=a(e).find("img").attr("data-path");A(b,e)})});else{a("#fileinfo tbody tr").click(function(){var e=a("td:first-child",this).attr("data-path");d.options.quickSelect&&
"dir"!=b[e]["File Type"]&&a(this).hasClass("cap_select")?w(b[e]):G(e)}).each(function(){a(this).contextMenu({menu:x(a(this))},function(b,e,c){e=a("td:first-child",e).attr("data-path");A(b,e)})});a("#fileinfo").find("table").tablesorter({textExtraction:function(b){return a(b).find("abbr").size()?a(b).find("abbr").attr("title"):b.innerHTML}});var m=setInterval(function(){X(m)},300)}}})},Z=function(b,c){var g=new Date,g=k+"?path="+encodeURIComponent(b)+"&config="+userconfig+"&mode=getfolder&showThumbs="+
d.options.showThumbs+"&time="+g.getMilliseconds();a.urlParam("type")&&(g+="&type="+a.urlParam("type"));a.getJSON(g,function(a){var b="";if("-1"==a.Code)J(a.Error);else{if(a){b+='<ul class="jqueryFileTree" style="display: none;">';for(key in a){var g="";for(cap in l)q(a[key],l[cap])&&(g+=" cap_"+l[cap]);if("dir"==a[key]["File Type"])var h=0==a[key].Protected?"":" directory-locked",b=b+('<li class="directory collapsed'+h+'"><a href="#" class="'+g+'" data-path="'+a[key].Path+'">'+a[key].Filename+"</a></li>");
else d.options.listFiles&&(h=0==a[key].Protected?"":" file-locked",b+='<li class="file ext_'+a[key]["File Type"].toLowerCase()+h+'"><a href="#" class="'+g+'" data-path="'+a[key].Path+'">'+a[key].Filename+"</a></li>")}b+="</ul>"}else b+="<h1>"+f.could_not_retrieve_folder+"</h1>";c(b)}})};a(function(){if(d.extras.extra_js)for(var b=0;b<d.extras.extra_js.length;b++)a.ajax({url:d.extras.extra_js[b],dataType:"script",async:d.extras.extra_js_async});a("#link-to-project").attr("href",d.url).attr("target",
"_blank").attr("title",f.support_fm+" ["+f.version+" : "+d.version+"]");a("div.version").html(d.version);loadCSS("./themes/"+d.options.theme+"/styles/filemanager.css");a.ajax({url:"./themes/"+d.options.theme+"/styles/ie.css",async:!1,success:function(b){a("head").append(b)}});loadJS("./scripts/zeroclipboard/dist/ZeroClipboard.js");d.edit.enabled&&(loadCSS("./scripts/CodeMirror/lib/codemirror.css"),loadCSS("./scripts/CodeMirror/theme/"+d.edit.theme+".css"),loadJS("./scripts/CodeMirror/lib/codemirror.js"),
loadJS("./scripts/CodeMirror/addon/selection/active-line.js"),loadCSS("./scripts/CodeMirror/addon/display/fullscreen.css"),loadJS("./scripts/CodeMirror/addon/display/fullscreen.js"),loadJS("./scripts/CodeMirror/dynamic-mode.js"));d.options.fileRoot?(fileRoot=d.options.serverRoot?"/"+d.options.fileRoot:d.options.fileRoot,fileRoot=fileRoot.replace(/\/\//g,"/")):fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/";baseUrl=!1===d.options.baseUrl?
window.location.protocol+"//"+window.location.host:d.options.baseUrl;0!=a.urlParam("exclusiveFolder")&&(fileRoot+=a.urlParam("exclusiveFolder"),"/"!=fileRoot.charAt(fileRoot.length-1)&&(fileRoot+="/"),fileRoot=fileRoot.replace(/\/\//g,"/"));0!=a.urlParam("expandedFolder")?(expandedFolder=a.urlParam("expandedFolder"),fullexpandedFolder=fileRoot+expandedFolder):(expandedFolder="",fullexpandedFolder=null);a("#folder-info").html('<span id="items-counter"></span> '+f.items+" - "+f.size+' : <span id="items-size"></span> '+
f.mb);1==d.options.autoload&&(a("#upload").append(f.upload),a("#newfolder").append(f.new_folder),a("#grid").attr("title",f.grid_view),a("#list").attr("title",f.list_view),a("#fileinfo h1").append(f.select_from_left),a('#itemOptions a[href$="#select"]').append(f.select),a('#itemOptions a[href$="#download"]').append(f.download),a('#itemOptions a[href$="#rename"]').append(f.rename),a('#itemOptions a[href$="#move"]').append(f.move),a('#itemOptions a[href$="#replace"]').append(f.replace),a('#itemOptions a[href$="#delete"]').append(f.del));
a.urlParam("CKEditorCleanUpFuncNum")&&(a("body").append('<button id="close-btn" type="button">'+f.close+"</button>"),a("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))}));a("#browse").append("+");a("#browse").attr("title",f.browse);a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))});!0===d.options.searchBox?loadJS("./scripts/filemanager.liveSearch.min.js"):a("#search").remove();a("button").wrapInner("<span></span>");
a("#fileinfo").data("view",d.options.defaultViewMode);B(d.options.defaultViewMode);a("#home").click(function(){var b=a("#fileinfo").data("view");a("#fileinfo").data("view",b);a("#filetree ul.jqueryFileTree > li.expanded > a").trigger("click");m(fileRoot)});a("#level-up").click(function(){var b=a("#uploader h1").attr("data-path");if(b!=fileRoot){var c=b.substring(0,b.slice(0,-1).lastIndexOf("/"))+"/",d=a("#fileinfo").data("view");a("#fileinfo").data("view",d);a("#filetree").find('a[data-path="'+b+
'"]').click();m(c)}});a("#grid").click(function(){B("grid");a("#fileinfo").data("view","grid");m(a("#currentpath").val())});a("#list").click(function(){B("list");a("#fileinfo").data("view","list");m(a("#currentpath").val())});D(fileRoot);d.upload.multiple?(loadCSS("./scripts/dropzone/downloads/css/dropzone.css"),loadJS("./scripts/dropzone/downloads/dropzone.js"),Dropzone.autoDiscover=!1,a("#file-input-container").remove(),a("#upload").remove(),a("#newfolder").before('<button value="Upload" type="button" name="upload" id="upload" class="em"><span>'+
f.upload+"</span></button> "),a("#upload").unbind().click(function(){var b='<div id="dropzone-container"><h2>'+f.current_folder+a("#uploader h1").attr("title")+'</h2><div id="multiple-uploads" class="dropzone"></div>',b=b+'<div id="total-progress"><div data-dz-uploadprogress="" style="width:0%;" class="progress-bar"></div></div>'+('<div class="prompt-info">'+f.dz_dictMaxFilesExceeded.replace("%s",d.upload.number)+f.file_size_limit+d.upload.fileSizeLimit+" "+f.mb+".</div>"),b=b+('<button id="process-upload">'+
f.upload+"</button></div>");error_flag=!1;var c=a("#currentpath").val(),g="auto"!=d.upload.fileSizeLimit?d.upload.fileSizeLimit:256,h="DISALLOW_ALL"==d.security.uploadPolicy?"."+d.security.uploadRestrictions.join(",."):null;if("images"==a.urlParam("type").toString().toLowerCase()||d.upload.imagesOnly)h="."+d.images.imagesExt.join(",.");var n={};n[f.close]=!1;a.prompt(b,{buttons:n});a("div#multiple-uploads").dropzone({paramName:"newfile",url:k+"?config="+userconfig,maxFilesize:g,maxFiles:d.upload.number,
addRemoveLinks:!0,parallelUploads:d.upload.number,dictCancelUpload:f.cancel,dictRemoveFile:f.del,dictMaxFilesExceeded:f.dz_dictMaxFilesExceeded.replace("%s",d.upload.number),dictDefaultMessage:f.dz_dictDefaultMessage,dictInvalidFileType:f.dz_dictInvalidFileType,dictFileTooBig:f.file_too_big+" "+f.file_size_limit+d.upload.fileSizeLimit+" "+f.mb,acceptedFiles:h,autoProcessQueue:!1,init:function(){var b=this;a("#process-upload").click(function(){b.processQueue()})},totaluploadprogress:function(b){a("#total-progress .progress-bar").css("width",
b+"%")},sending:function(a,b,e){e.append("mode","add");e.append("currentpath",c)},success:function(b,e){a("#uploadresponse").empty().html(e);var d=jQuery.parseJSON(a("#uploadresponse").find("textarea").text());0==d.Code?this.removeFile(b):(m(c),a("#filetree").find('a[data-path="'+c+'"]').click(),a.prompt(d.Error),error_flag=!0)},complete:function(b){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&(a("#total-progress .progress-bar").css("width","0%"),0===this.getRejectedFiles().length&&
!1===error_flag&&setTimeout(function(){a.prompt.close()},800),m(c),c==fileRoot&&v(),a("#filetree").find('a[data-path="'+c+'"]').click().click(),d.options.showConfirmation&&a.prompt(f.successful_added_file))}})})):(a("#uploader").attr("action",k+"?config="+userconfig),a("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(b,c,g){if(""==a("#newfile",c).val())return!1;if(!K(a("#newfile",c).val()))return c="<p>"+f.INVALID_FILE_TYPE+"</p>","DISALLOW_ALL"==d.security.uploadPolicy&&(c+=
"<p>"+f.ALLOWED_FILE_TYPE+d.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==d.security.uploadPolicy&&(c+="<p>"+f.DISALLOWED_FILE_TYPE+d.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),a.prompt(c),!1;a("#upload").attr("disabled",!0);a("#upload span").addClass("loading").text(f.loading_data);if("images"==a.urlParam("type").toString().toLowerCase()){b=a("#newfile",c).val().toLowerCase().split(".");g=!1;for(key in d.images.imagesExt)d.images.imagesExt[key]==b[b.length-
1]&&(g=!0);if(!1===g)return a.prompt(f.UPLOAD_IMAGES_ONLY),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload),!1}if("undefined"!==typeof FileReader&&"auto"!=typeof d.upload.fileSizeLimit&&a("#newfile",c).get(0).files[0].size>1048576*d.upload.fileSizeLimit)return a.prompt("<p>"+f.file_too_big+"</p><p>"+f.file_size_limit+d.upload.fileSizeLimit+" "+f.mb+".</p>"),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload),!1},error:function(b,
c,d){a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(f.upload);a.prompt(f.ERROR_UPLOADING_FILE)},success:function(b){b=jQuery.parseJSON(a("#uploadresponse").find("textarea").text());if(0==b.Code){var c=b.Path,g=b.Name,h=p(g),k=a("#filetree").find('a[data-path="'+c+'"]'),l=k.parent(),g='<li class="file ext_'+h+'"><a data-path="'+c+g+'" href="#" class="">'+g+"</a></li>";l.find("ul").size()?(l.find("ul").prepend(g),k.click().click()):(l=a("#filetree").find("ul.jqueryFileTree"),
l.prepend(g),v());m(c);d.options.showConfirmation&&a.prompt(f.successful_added_file);a("#filepath, #newfile").val("");a.browser.msie&&a("#newfile").replaceWith(a("#newfile").clone(!0));a("#filetree").find('a[data-path="'+b.Path+'/"]').click().click()}else a.prompt(b.Error);a("#upload").removeAttr("disabled");a("#upload span").removeClass("loading").text(f.upload);a("#filepath").val("")}}));if(d.customScrollbar.enabled){loadCSS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css");loadJS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js");
var c=void 0!=d.customScrollbar.theme?d.customScrollbar.theme:"inset-2-dark",g=void 0!=d.customScrollbar.button?d.customScrollbar.button:!0;a(window).load(function(){a("#filetree").append('<div style="height:3000px"></div>');a("#filetree").mCustomScrollbar({theme:c,scrollButtons:{enable:g},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onInit:function(){v()}},axis:"yx"});a("#fileinfo").mCustomScrollbar({theme:c,scrollButtons:{enable:g},advanced:{autoExpandHorizontalScroll:!0,
updateOnContentResize:!0},axis:"y",alwaysShowScrollbar:1})})}else v();window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a('#itemOptions a[href$="#select"]').remove();1==d.options.browseOnly&&(a("#file-input-container").remove(),a("#upload").remove(),a("#newfolder").remove(),a("#toolbar").remove("#rename"),a(".contextMenu .rename").remove(),a(".contextMenu .move").remove(),a(".contextMenu .replace").remove(),a(".contextMenu .delete").remove());y();a(window).resize(y);a("#splitter").splitter({sizeLeft:d.options.splitterMinWidth,
minLeft:d.options.splitterMinWidth,minRight:200});G(fileRoot+expandedFolder)});document.documentElement.setAttribute("data-useragent",navigator.userAgent);d.options.logger&&(t=(new Date).getTime(),console.log("Total execution time : "+(t-R)+" ms"));a(window).load(function(){y()})})(jQuery);$(window).load(function(){$("#fileinfo").css({left:$("#splitter .vsplitbar").width()+$("#filetree").width()})});
>>>>>>> c75b9144aaed3060951f996ae097f2ed68cb0d55
