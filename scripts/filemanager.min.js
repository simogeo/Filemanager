/*
	MIT License
 @author		Jason Huck - Core Five Labs
 @author		Simon Georget <simon (at) linea21 (dot) com>
 @copyright	Authors
*/
(function(a){function H(a){var e=this.window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;if(!e)throw Error("XMLHttpRequest not supported");e.open("HEAD",a,!1);e.send(null);return 200==e.status?!0:!1}function r(b,e){return"dir"==b["File Type"]&&"replace"==e?!1:"dir"==b["File Type"]&&"download"==e?1==f.security.allowFolderDownload?!0:!1:"undefined"==typeof b.Capabilities?!0:-1<a.inArray(e,b.Capabilities)}function x(b){var e=b.attr("class").replace(/ /g,"_");if(""==e)return"itemOptions";
if(!a("#"+e).length){var d=a("#itemOptions").clone().attr("id",e);b.hasClass("cap_select")||a(".select",d).remove();b.hasClass("cap_download")||a(".download",d).remove();b.hasClass("cap_rename")||a(".rename",d).remove();b.hasClass("cap_move")||a(".move",d).remove();a(".replace",d).remove();b.hasClass("cap_delete")||a(".delete",d).remove();a("#itemOptions").after(d)}return e}a.urlParam=function(a){return(a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(window.location.href))?a[1]:0};var t=function(b){var e=
null;"user"==("undefined"===typeof b?"user":b)?0!=a.urlParam("config")?(b="./scripts/"+a.urlParam("config"),userconfig=a.urlParam("config")):(b="./scripts/filemanager.config.json",userconfig="filemanager.config.json"):b="./scripts/filemanager.config.default.json";a.ajax({async:!1,url:b,dataType:"json",cache:!1,success:function(a){e=a}});return e},Q=t("default"),f=t();null!==f&&delete f.version;f=a.extend({},Q,f);if(f.options.logger)var R=(new Date).getTime();HEAD_included_files=[];loadCSS=function(b){if(-1==
a.inArray(b,HEAD_included_files)){var e=a("<link rel='stylesheet' type='text/css' href='"+b+"'>");a("head").append(e);HEAD_included_files.push(b)}};loadJS=function(b){if(-1==a.inArray(b,HEAD_included_files)){var e=a("<script type='text/javascript' src='"+b+"'>");a("head").append(e);HEAD_included_files.push(b)}};smartPath=function(a,e){var d=a.split("/"),d="/"+d[d.length-2]+"/",c=e.indexOf(d);rvalue=-1==c?a+e:a+e.substring(c+d.length);f.options.logger&&console.log("url : "+a+" - path : "+e+" - separator : "+
d+" -  pos : "+c+" - returned value : "+rvalue);return rvalue};var k=f.options.fileConnector||"connectors/"+f.options.lang+"/filemanager."+f.options.lang,n=f.options.capabilities||"select download rename move delete replace".split(" ");0!=a.urlParam("langCode")&&(H("scripts/languages/"+a.urlParam("langCode")+".js")?f.options.culture=a.urlParam("langCode"):(t=a.urlParam("langCode").substring(0,2),H("scripts/languages/"+t+".js")&&(f.options.culture=t)));var g=[];a.ajax({url:"scripts/languages/"+f.options.culture+
".js",async:!1,dataType:"json",success:function(a){g=a}});a.prompt.setDefaults({overlayspeed:"fast",show:"fadeIn",opacity:.4,persistent:!1});var y=function(){var b=53,e=a("#uploader");a.urlParam("CKEditorCleanUpFuncNum")&&(b+=60);b=a(window).height()-e.height()-e.offset().top-b;a("#splitter, #filetree, #fileinfo, .vsplitbar").height(b);b=a("#splitter").width()-a("div.vsplitbar").width()-a("#filetree").width();a("#fileinfo").width(b)},z=function(a,e){e="undefined"===typeof e?!0:!1;if(0==f.options.showFullPath){if("function"===
typeof displayPathDecorator)return displayPathDecorator(a.replace(fileRoot,"/"));a=a.replace(fileRoot,"/");if(50<a.length&&!0===e){var d=a.split("/");a="/"+d[1]+"/"+d[2]+"/(...)/"+d[d.length-2]+"/"}}return a},B=function(b){"grid"==b?(a("#grid").addClass("ON"),a("#list").removeClass("ON")):(a("#list").addClass("ON"),a("#grid").removeClass("ON"))},C=function(a){var e="",e="\u0160\u0161\u0110\u0111\u017d\u017e\u010c\u010d\u0106\u0107\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00c6\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u0150\u00d8\u00d9\u00da\u00db\u00dc\u00dd\u00de\u00df\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00e6\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f0\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u0151\u00f8\u00f9\u00fa\u00fb\u00fc\u00fd\u00fd\u00fe\u00ff\u0154\u0155 '/".split(""),
d="S s Dj dj Z z C c C c A A A A A A A C E E E E I I I I N O O O O O O O U U U U Y B Ss a a a a a a a c e e e e i i i i o n o o o o o o o u u u u y y b y R r _ _ ".split(" ");a=String(a);for(i=0;i<e.length;i++)a=a.replace(RegExp(e[i],"g"),d[i]);e=a;f.options.chars_only_latin&&(e=e.replace(/[^_a-zA-Z0-9]/g,""));e=e.replace(/[_]+/g,"_");""==e&&(e="unsupportedCharsReplacement");return e},S=function(a){filename="";-1!=a.lastIndexOf(".")?(filename=C(a.substr(0,a.lastIndexOf("."))),filename+="."+a.split(".").pop()):
filename=C(a);return filename},I=function(a){a=parseFloat(a);for(var e=0,d=[g.bytes,g.kb,g.mb,g.gb];;){if(1024>a)return a=Math.round(100*a)/100,a+d[e];a/=1024;e+=1}},J=function(b){a("#fileinfo").html("<h1>"+b+"</h1>");a("#newfile").attr("disabled","disabled");a("#upload").attr("disabled","disabled");a("#newfolder").attr("disabled","disabled")},K=function(b){b=q(b);return""==b&&1==f.security.allowNoExtension||"DISALLOW_ALL"==f.security.uploadPolicy&&-1!=a.inArray(b,f.security.uploadRestrictions)||
"ALLOW_ALL"==f.security.uploadPolicy&&-1==a.inArray(b,f.security.uploadRestrictions)?!0:!1},q=function(a){return 1==a.split(".").length?"":a.split(".").pop().toLowerCase()},T=function(a){return-1!=a.lastIndexOf(".")?a.substring(0,a.lastIndexOf(".")):a},U=function(b){var e="<video width="+f.videos.videosPlayerWidth+" height="+f.videos.videosPlayerHeight+' src="'+b.Path+'" controls="controls">',e=e+('<img src="'+b.Preview+'" />'),e=e+"</video>";a("#fileinfo img").remove();a("#fileinfo #preview #main-title").before(e)},
V=function(b){var e='<audio src="'+b.Path+'" controls="controls">',e=e+('<img src="'+b.Preview+'" />'),e=e+"</audio>";a("#fileinfo img").remove();a("#fileinfo #preview #main-title").before(e)},W=function(b){b='<iframe id="fm-pdf-viewer" src = "scripts/ViewerJS/index.html#'+b.Path+'" width="'+f.pdfs.pdfsReaderWidth+'" height="'+f.pdfs.pdfsReaderHeight+'" allowfullscreen webkitallowfullscreen></iframe>';a("#fileinfo img").remove();a("#fileinfo #preview #main-title").before(b)},X=function(b){a("#fileinfo").find("td:first-child").each(function(){var e=
a(this).attr("data-path"),e=a("#filetree").find('a[data-path="'+e+'"]').parent();"undefined"!==typeof e.css("background-image")&&(a(this).css("background-image",e.css("background-image")),window.clearInterval(b))})},D=function(b){a("#currentpath").val(b);a("#uploader h1").text(g.current_folder+z(b)).attr("title",z(b,!1)).attr("data-path",b);a("#newfolder").unbind().click(function(){var b=g.default_foldername,d=g.prompt_foldername+' : <input id="fname" name="fname" type="text" value="'+b+'" />',c=
{};c[g.create_folder]=!0;c[g.cancel]=!1;a.prompt(d,{callback:function(c,d){if(1!=c)return!1;var f=d.children("#fname").val();""!=f?(b=C(f),f=new Date,a.getJSON(k+"?mode=addfolder&path="+a("#currentpath").val()+"&config="+userconfig+"&name="+encodeURIComponent(b)+"&time="+f.getMilliseconds(),function(c){0==c.Code?(Y(c.Parent,c.Name),m(c.Parent),a("#filetree").find('a[data-path="'+c.Parent+'/"]').click().click()):a.prompt(c.Error)})):a.prompt(g.no_foldername)},buttons:c})})},P=function(b){a("#fileinfo button").each(function(b){0==
a(this).find("span").length&&a(this).wrapInner("<span></span>")});if(r(b,"select")){if(a("#fileinfo").find("button#select").click(function(){w(b)}).show(),window.opener||window.tinyMCEPopup)a("#preview img").attr("title",g.select),a("#preview img").click(function(){w(b)}).css("cursor","pointer")}else a("#fileinfo").find("button#select").hide();r(b,"rename")?a("#fileinfo").find("button#rename").click(function(){var e=L(b);e.length&&a("#fileinfo > h1").text(e)}).show():a("#fileinfo").find("button#rename").hide();
r(b,"move")?a("#fileinfo").find("button#move").click(function(){var e=M(b);e.length&&a("#fileinfo > h1").text(e)}).show():a("#fileinfo").find("button#move").hide();r(b,"replace")?a("#fileinfo").find("button#replace").click(function(){N(b)}).show():a("#fileinfo").find("button#replace").hide();r(b,"delete")?a("#fileinfo").find("button#delete").click(function(){O(b)&&a("#fileinfo").html("<h1>"+g.select_from_left+"</h1>")}).show():a("#fileinfo").find("button#delete").hide();r(b,"download")?a("#fileinfo").find("button#download").click(function(){window.location=
k+"?mode=download&path="+encodeURIComponent(b.Path)+"&config="+userconfig}).show():a("#fileinfo").find("button#download").hide()},v=function(){var b=0<a("#filetree .mCSB_container").length?"#filetree .mCSB_container":"#filetree";a(b).fileTree({root:fileRoot,datafunc:Z,multiFolder:!1,folderCallback:function(a){m(a)},expandedFolder:fullexpandedFolder,after:function(b){a("#filetree").find("li a").each(function(){a(this).contextMenu({menu:x(a(this))},function(b,c,e){c=a(c).attr("data-path");A(b,c)})});
1==f.options.searchBox&&(a("#q").liveUpdate("#filetree ul").blur(),a("#search span.q-inactive").html(g.search),a("#search a.q-reset").attr("title",g.search_reset))}},function(a){E(a)})},w=function(b){var e=!1!==f.options.baseUrl?smartPath(baseUrl,b.Path.replace(fileRoot,"")):b.Path;window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a.urlParam("CKEditorCleanUpFuncNum")||a.urlParam("CKEditor")?window.tinyMCEPopup?(b=tinyMCEPopup.getWindowArg("window"),b.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=
e,"undefined"!=typeof b.ImageDialog&&(b.ImageDialog.getImageData&&b.ImageDialog.getImageData(),b.ImageDialog.showPreviewImage&&b.ImageDialog.showPreviewImage(e)),tinyMCEPopup.close()):(a.urlParam("field_name")?(parent.document.getElementById(a.urlParam("field_name")).value=e,"undefined"!==typeof parent.tinyMCE&&parent.tinyMCE.activeEditor.windowManager.close(),"undefined"!==typeof parent.$.fn.colorbox&&parent.$.fn.colorbox.close()):a.urlParam("CKEditor")?window.opener?window.opener.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),
e):(parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorFuncNum"),e),parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))):""!=b.Properties.Width?window.opener.SetUrl(e,b.Properties.Width,b.Properties.Height):window.opener.SetUrl(e),window.opener&&window.close()):a.prompt(g.fck_select_integration)},L=function(b){var e="",d=f.security.allowChangeExtensions?b.Filename:T(b.Filename),d=g.new_filename+' : <input id="rname" name="rname" type="text" value="'+d+'" />',c={};c[g.rename]=
!0;c[g.cancel]=!1;a.prompt(d,{callback:function(c,d){if(1!=c)return!1;rname=d.children("#rname").val();if(""!=rname){var h=rname;if(!f.security.allowChangeExtensions){var h=S(rname),l=q(b.Filename);0<l.length&&(h=h+"."+l)}if("/"!=b.Path.charAt(b.Path.length-1)&&!K(h))return h="<p>"+g.INVALID_FILE_TYPE+"</p>","DISALLOW_ALL"==f.security.uploadPolicy&&(h+="<p>"+g.ALLOWED_FILE_TYPE+f.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==f.security.uploadPolicy&&(h+="<p>"+g.DISALLOWED_FILE_TYPE+
f.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),a.prompt(h),!1;h=k+"?mode=rename&old="+encodeURIComponent(b.Path)+"&new="+encodeURIComponent(h)+"&config="+userconfig;a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(c){if(0==c.Code){var d=c["New Path"],u=c["New Name"],h=c["Old Path"],p=a("#filetree").find('a[data-path="'+h+'"]'),l=p.parent().parent().prev("a");p.attr("data-path",d).text(u);0==l.length?v():l.click().click();p=a("#preview h1").attr("title");
"undefined"!=typeof p&&p==h&&a("#preview h1").text(u);"grid"==a("#fileinfo").data("view")?(a('#fileinfo img[data-path="'+h+'"]').parent().next("p").text(u),a('#fileinfo img[data-path="'+h+'"]').attr("data-path",d)):(a('#fileinfo td[data-path="'+h+'"]').text(u),a('#fileinfo td[data-path="'+h+'"]').attr("data-path",d));a("#preview h1").html(u);b.Path=d;b.Filename=u;a("#fileinfo").find("button#rename, button#delete, button#download").unbind();P(b);f.options.showConfirmation&&a.prompt(g.successful_rename)}else a.prompt(c.Error);
e=c["New Name"]}})}},buttons:c});return e},N=function(b){a("#fileR").bind("change",function(){a(this).closest("form#toolbar").submit()});a("#toolbar").attr("action",k);a("#toolbar").attr("method","post");a("#toolbar").ajaxForm({target:"#uploadresponse",beforeSubmit:function(e,d,c){e=a("#fileR",d).val();if(""==e)return!1;if(q(e)!=b["File Type"])return a.prompt(g.ERROR_REPLACING_FILE+" ."+q(b.Filename)),!1;a("#replace").attr("disabled",!0);a("#upload span").addClass("loading").text(g.loading_data);
if("undefined"!==typeof FileReader&&"auto"!=typeof f.upload.fileSizeLimit&&a("#fileR",d).get(0).files[0].size>1048576*f.upload.fileSizeLimit)return a.prompt("<p>"+g.file_too_big+"</p><p>"+g.file_size_limit+f.upload.fileSizeLimit+" "+g.mb+".</p>"),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(g.upload),!1},error:function(b,d,c){a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(g.upload);a.prompt(g.ERROR_UPLOADING_FILE)},success:function(b){b=
jQuery.parseJSON(a("#uploadresponse").find("textarea").text());0==b.Code?(b=b.Path+"/"+b.Name,E(b),a("#preview").find("img").hide().fadeIn("slow"),a("ul.jqueryFileTree").find('li a[data-path="'+b+'"]').parent().hide().fadeIn("slow"),f.options.showConfirmation&&a.prompt(g.successful_replace)):a.prompt(b.Error);a("#replace").removeAttr("disabled");a("#upload span").removeClass("loading").text(g.upload)}});a("#newfilepath").val(b.Path);a("#fileR").click()},M=function(b){var e="",d=g.move+' : <input id="rname" name="rname" type="text" value="" />',
d=d+('<div class="prompt-info">'+g.help_move+"</div>"),c={};c[g.move]=!0;c[g.cancel]=!1;a.prompt(d,{callback:function(c,d){if(1!=c)return!1;rname=d.children("#rname").val();if(""!=rname){var h=rname,h=k+"?mode=move&old="+encodeURIComponent(b.Path)+"&new="+encodeURIComponent(h)+"&root="+encodeURIComponent(fileRoot)+"&config="+userconfig;a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(c){if(0==c.Code){var b=c["New Path"],d=c["New Name"];fullexpandedFolder=b;v();m(b);f.options.showConfirmation&&
a.prompt(g.successful_moved)}else a.prompt(c.Error);e=b+d}})}},buttons:c});return e},O=function(b){var e=!1,d=g.confirmation_delete,c={};c[g.yes]=!0;c[g.no]=!1;a.prompt(d,{callback:function(c,d){if(1!=c)return!1;var h=new Date,h=k+"?mode=delete&path="+encodeURIComponent(b.Path)+"&time="+h.getMilliseconds()+"&config="+userconfig,l=b.Path.split("/").reverse().slice(1).reverse().join("/")+"/";a.ajax({type:"GET",url:h,dataType:"json",async:!1,success:function(c){0==c.Code?(aa(c.Path),c=c.Path.substring(0,
c.Path.length-1),c=c.substr(0,c.lastIndexOf("/")+1),a("#uploader h1").text(g.current_folder+z(c)).attr("title",z(c,!1)).attr("data-path",c),e=!0,f.options.showConfirmation&&a.prompt(g.successful_delete),a("#filetree").find('a[data-path="'+l+'/"]').click().click()):(e=!1,a.prompt(c.Error))}})},buttons:c});return e},ba=function(b){isEdited=!1;a("#fileinfo").find("div#tools").append(' <a id="edit-file" href="#" title="'+g.edit+'"><span>'+g.edit+"</span></a>");a("#edit-file").click(function(){a(this).hide();
var e=new Date,e=k+"?mode=editfile&path="+encodeURIComponent(b.Path)+"&config="+userconfig+"&time="+e.getMilliseconds();a.ajax({type:"GET",url:e,dataType:"json",async:!1,success:function(d){0==d.Code?(d='<form id="edit-form">'+('<textarea id="edit-content" name="content">'+d.Content+"</textarea>"),d=d+'<input type="hidden" name="mode" value="savefile" />'+('<input type="hidden" name="path" value="'+b.Path+'" />'),d+='<button id="edit-cancel" class="edition" type="button">'+g.quit_editor+"</button>",
d+='<button id="edit-save" class="edition" type="button">'+g.save+"</button>",d+="</form>",a("#preview").find("img").hide(),a("#preview").prepend(d).hide().fadeIn(),a("#edit-cancel").click(function(){a("#preview").find("form#edit-form").hide();a("#preview").find("img").fadeIn();a("#edit-file").show()}),a("#edit-save").click(function(){var c=codeMirrorEditor.getValue();a("textarea#edit-content").val(c);c=a("#edit-form").serializeArray();a.ajax({type:"POST",url:k+"?config="+userconfig,dataType:"json",
data:c,async:!1,success:function(c){0==c.Code?(isEdited=!0,a.prompt(g.successful_edit)):(isEdited=!1,a.prompt(c.Error))}})}),codeMirrorEditor=instantiateCodeMirror(q(b.Path),f)):(isEdited=!1,a.prompt(d.Error),a(this).show())}})});return isEdited},aa=function(b){a("#filetree").find('a[data-path="'+b+'"]').parent().fadeOut("slow",function(){a(this).remove()});if(a("#uploader h1").attr("data-path")==b){var f=b.split("/").slice(0,length-2).join("/")+"/";m(f)}"grid"==a("#fileinfo").data("view")?a('#contents img[data-path="'+
b+'"]').parent().parent().fadeOut("slow",function(){a(this).remove()}):a("table#contents").find('td[data-path="'+b+'"]').parent().fadeOut("slow",function(){a(this).remove()});a("#preview").length&&m(b.substr(0,b.lastIndexOf("/")+1))},Y=function(b,e){var d='<li class="directory collapsed"><a data-path="'+b+e+'/" href="#">'+e+'</a><ul class="jqueryFileTree" style="display: block;"></ul></li>',c=a("#filetree").find('a[data-path="'+b+'"]');b!=fileRoot?c.next("ul").prepend(d).prev("a").click().click():
(a("#filetree ul.jqueryFileTree").prepend(d),a("#filetree").find('li a[data-path="'+b+e+'/"]').attr("class","cap_rename cap_delete").click(function(){m(b+e+"/")}).each(function(){a(this).contextMenu({menu:x(a(this))},function(c,b,d){b=a(b).attr("data-path");A(c,b)})}));f.options.showConfirmation&&a.prompt(g.successful_added_folder)},G=function(b){b.lastIndexOf("/")==b.length-1?(m(b),a("#filetree").find('a[data-path="'+b+'"]').click()):E(b)},A=function(b,f){var d=new Date;a.getJSON(k+"?mode=getinfo&path="+
encodeURIComponent(f)+"&config="+userconfig+"&time="+d.getMilliseconds(),function(c){"grid"==a("#fileinfo").data("view")?a("#fileinfo").find('img[data-path="'+c.Path+'"]').parent():a("#fileinfo").find('td[data-path="'+c.Path+'"]').parent();switch(b){case "select":w(c);break;case "download":window.location=k+"?mode=download&path="+c.Path+"&config="+userconfig+"&time="+d.getMilliseconds();break;case "rename":L(c);break;case "replace":N(c);break;case "move":M(c);break;case "delete":O(c)}})},E=function(b){a(".contextMenu").hide();
var e=b.substr(0,b.lastIndexOf("/")+1);D(e);var d;d='<div id="preview"><img /><div id="main-title"><h1></h1><div id="tools"></div></div><dl></dl></div><form id="toolbar">'+('<button id="parentfolder">'+g.parentfolder+"</button>");-1!=a.inArray("select",n)&&(a.urlParam("CKEditor")||window.opener||window.tinyMCEPopup||a.urlParam("field_name"))&&(d+='<button id="select" name="select" type="button" value="Select">'+g.select+"</button>");-1!=a.inArray("download",n)&&(d+='<button id="download" name="download" type="button" value="Download">'+
g.download+"</button>");-1!=a.inArray("rename",n)&&1!=f.options.browseOnly&&(d+='<button id="rename" name="rename" type="button" value="Rename">'+g.rename+"</button>");-1!=a.inArray("move",n)&&1!=f.options.browseOnly&&(d+='<button id="move" name="move" type="button" value="Move">'+g.move+"</button>");-1!=a.inArray("delete",n)&&1!=f.options.browseOnly&&(d+='<button id="delete" name="delete" type="button" value="Delete">'+g.del+"</button>");-1!=a.inArray("replace",n)&&1!=f.options.browseOnly&&(d+='<button id="replace" name="replace" type="button" value="Replace">'+
g.replace+"</button>",d+='<div class="hidden-file-input"><input id="fileR" name="fileR" type="file" /></div>',d+='<input id="mode" name="mode" type="hidden" value="replace" /> ',d+='<input id="newfilepath" name="newfilepath" type="hidden" />');d+="</form>";0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(d):a("#fileinfo").html(d);a("#parentfolder").click(function(){m(e)});d=new Date;a.getJSON(k+"?mode=getinfo&path="+encodeURIComponent(b)+"&config="+userconfig+"&time="+d.getMilliseconds(),
function(c){if(0==c.Code){a("#fileinfo").find("h1").text(c.Filename).attr("title",b);a("#fileinfo").find("img").attr("src",c.Preview);var d;d=-1!=a.inArray(q(c.Filename),f.videos.videosExt)?!0:!1;d&&1==f.videos.showVideoPlayer&&U(c);d=-1!=a.inArray(q(c.Filename),f.audios.audiosExt)?!0:!1;d&&1==f.audios.showAudioPlayer&&V(c);d=-1!=a.inArray(q(c.Filename),f.pdfs.pdfsExt)?!0:!1;d&&1==f.pdfs.showPdfReader&&W(c);d=-1!=a.inArray(q(c.Filename),f.edit.editExt)?!0:!1;d&&1==f.edit.enabled&&0==c.Protected&&
ba(c);d=new Date;var e=!1!==f.options.baseUrl?smartPath(baseUrl,c.Path.replace(fileRoot,"")):c.Path;0==c.Protected&&(a("#fileinfo").find("div#tools").append(' <a id="copy-button" data-clipboard-text="'+e+'" title="'+g.copy_to_clipboard+'" href="#"><span>'+g.copy_to_clipboard+"</span></a>"),loadJS("./scripts/zeroclipboard/copy.js?d"+d.getMilliseconds()),a("#copy-button").click(function(){a("#fileinfo").find("div#tools").append('<span id="copied">'+g.copied+"</span>");a("#copied").delay(500).fadeOut(1E3,
function(){a(this).remove()})}));d="";c.Properties.Width&&""!=c.Properties.Width&&(d+="<dt>"+g.dimensions+"</dt><dd>"+c.Properties.Width+"x"+c.Properties.Height+"</dd>");c.Properties["Date Created"]&&""!=c.Properties["Date Created"]&&(d+="<dt>"+g.created+"</dt><dd>"+c.Properties["Date Created"]+"</dd>");c.Properties["Date Modified"]&&""!=c.Properties["Date Modified"]&&(d+="<dt>"+g.modified+"</dt><dd>"+c.Properties["Date Modified"]+"</dd>");if(c.Properties.Size||0==parseInt(c.Properties.Size))d+="<dt>"+
g.size+"</dt><dd>"+I(c.Properties.Size)+"</dd>";a("#fileinfo").find("dl").html(d);P(c)}else a.prompt(c.Error)})},m=function(b){D(b);var e='<img id="activity" src="themes/'+f.options.theme+'/images/wait30trans.gif" width="30" height="30" />';0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(e):a("#fileinfo").html(e);a("#loading-wrap").fadeOut(800);e=new Date;b=k+"?path="+encodeURIComponent(b)+"&config="+userconfig+"&mode=getfolder&showThumbs="+f.options.showThumbs+"&time="+
e.getMilliseconds();a.urlParam("type")&&(b+="&type="+a.urlParam("type"));a.getJSON(b,function(b){var c="";if("-1"==b.Code)J(b.Error);else{y();if(b){var e=0,p=0;if("grid"==a("#fileinfo").data("view")){c+='<ul id="contents" class="grid">';for(key in b){e++;var h=b[key].Properties,l="";for(cap in n)r(b[key],n[cap])&&(l+=" cap_"+n[cap]);var F=64,k=h.Width;1<k&&k<F&&(F=k);f.options.showTitleAttr?title=' title="'+b[key].Path+'"':title="";c+='<li class="'+l+'"'+title+'"><div class="clip"><img src="'+b[key].Preview+
'" width="'+F+'" alt="'+b[key].Path+'" data-path="'+b[key].Path+'" /></div><p>'+b[key].Filename+"</p>";h.Width&&""!=h.Width&&(c+='<span class="meta dimensions">'+h.Width+"x"+h.Height+"</span>");h.Size&&""!=h.Size&&(c+='<span class="meta size">'+h.Size+"</span>");h.Size&&""!=h.Size&&(p+=h.Size);h["Date Created"]&&""!=h["Date Created"]&&(c+='<span class="meta created">'+h["Date Created"]+"</span>");h["Date Modified"]&&""!=h["Date Modified"]&&(c+='<span class="meta modified">'+h["Date Modified"]+"</span>");
c+="</li>"}c+="</ul>"}else{c=c+'<table id="contents" class="list">'+('<thead><tr><th class="headerSortDown"><span>'+g.name+"</span></th><th><span>"+g.dimensions+"</span></th><th><span>"+g.size+"</span></th><th><span>"+g.modified+"</span></th></tr></thead>");c+="<tbody>";for(key in b){e++;h=b[key].Properties;l="";f.options.showTitleAttr?title=' title="'+b[key].Path+'"':title="";for(cap in n)r(b[key],n[cap])&&(l+=" cap_"+n[cap]);c+='<tr class="'+l+'">';c+='<td data-path="'+b[key].Path+'"'+title+'">'+
b[key].Filename+"</td>";c=h.Width&&""!=h.Width?c+("<td>"+h.Width+"x"+h.Height+"</td>"):c+"<td></td>";h.Size&&""!=h.Size?(c+='<td><abbr title="'+h.Size+'">'+I(h.Size)+"</abbr></td>",p+=h.Size):c+="<td></td>";c=h["Date Modified"]&&""!=h["Date Modified"]?c+("<td>"+h["Date Modified"]+"</td>"):c+"<td></td>";c+="</tr>"}c+="</tbody>";c+="</table>"}}else c+="<h1>"+g.could_not_retrieve_folder+"</h1>";0<a("#fileinfo .mCSB_container").length?a("#fileinfo .mCSB_container").html(c):a("#fileinfo").html(c);a("#items-counter").text(e);
a("#items-size").text(Math.round(p/1024/1024*100)/100);if("grid"==a("#fileinfo").data("view"))a("#fileinfo").find("#contents li").click(function(){var c=a(this).find("img").attr("data-path");f.options.quickSelect&&"dir"!=b[c]["File Type"]&&a(this).hasClass("cap_select")?w(b[c]):G(c)}).each(function(){a(this).contextMenu({menu:x(a(this))},function(c,b,d){b=a(b).find("img").attr("data-path");A(c,b)})});else{a("#fileinfo tbody tr").click(function(){var c=a("td:first-child",this).attr("data-path");f.options.quickSelect&&
"dir"!=b[c]["File Type"]&&a(this).hasClass("cap_select")?w(b[c]):G(c)}).each(function(){a(this).contextMenu({menu:x(a(this))},function(c,b,d){b=a("td:first-child",b).attr("data-path");A(c,b)})});a("#fileinfo").find("table").tablesorter({textExtraction:function(c){return a(c).find("abbr").size()?a(c).find("abbr").attr("title"):c.innerHTML}});var m=setInterval(function(){X(m)},300)}}})},Z=function(b,e){var d=new Date,d=k+"?path="+encodeURIComponent(b)+"&config="+userconfig+"&mode=getfolder&showThumbs="+
f.options.showThumbs+"&time="+d.getMilliseconds();a.urlParam("type")&&(d+="&type="+a.urlParam("type"));a.getJSON(d,function(a){var b="";if("-1"==a.Code)J(a.Error);else{if(a){b+='<ul class="jqueryFileTree" style="display: none;">';for(key in a){var d="";for(cap in n)r(a[key],n[cap])&&(d+=" cap_"+n[cap]);if("dir"==a[key]["File Type"])var h=0==a[key].Protected?"":" directory-locked",b=b+('<li class="directory collapsed'+h+'"><a href="#" class="'+d+'" data-path="'+a[key].Path+'">'+a[key].Filename+"</a></li>");
else f.options.listFiles&&(h=0==a[key].Protected?"":" file-locked",b+='<li class="file ext_'+a[key]["File Type"].toLowerCase()+h+'"><a href="#" class="'+d+'" data-path="'+a[key].Path+'">'+a[key].Filename+"</a></li>")}b+="</ul>"}else b+="<h1>"+g.could_not_retrieve_folder+"</h1>";e(b)}})};a(function(){if(f.extras.extra_js)for(var b=0;b<f.extras.extra_js.length;b++)a.ajax({url:f.extras.extra_js[b],dataType:"script",async:f.extras.extra_js_async});a("#link-to-project").attr("href",f.url).attr("target",
"_blank").attr("title",g.support_fm+" ["+g.version+" : "+f.version+"]");a("div.version").html(f.version);loadCSS("./themes/"+f.options.theme+"/styles/filemanager.css");a.ajax({url:"./themes/"+f.options.theme+"/styles/ie.css",async:!1,success:function(b){a("head").append(b)}});loadJS("./scripts/zeroclipboard/dist/ZeroClipboard.js");f.edit.enabled&&(loadCSS("./scripts/CodeMirror/lib/codemirror.css"),loadCSS("./scripts/CodeMirror/theme/"+f.edit.theme+".css"),loadJS("./scripts/CodeMirror/lib/codemirror.js"),
loadJS("./scripts/CodeMirror/addon/selection/active-line.js"),loadCSS("./scripts/CodeMirror/addon/display/fullscreen.css"),loadJS("./scripts/CodeMirror/addon/display/fullscreen.js"),loadJS("./scripts/CodeMirror/dynamic-mode.js"));f.options.fileRoot?(fileRoot=f.options.serverRoot?"/"+f.options.fileRoot:f.options.fileRoot,fileRoot=fileRoot.replace(/\/\//g,"/")):fileRoot="/"+document.location.pathname.substring(1,document.location.pathname.lastIndexOf("/")+1)+"userfiles/";baseUrl=!1===f.options.baseUrl?
window.location.protocol+"//"+window.location.host:f.options.baseUrl;0!=a.urlParam("exclusiveFolder")&&(fileRoot+=a.urlParam("exclusiveFolder"),"/"!=fileRoot.charAt(fileRoot.length-1)&&(fileRoot+="/"),fileRoot=fileRoot.replace(/\/\//g,"/"));0!=a.urlParam("expandedFolder")?(expandedFolder=a.urlParam("expandedFolder"),fullexpandedFolder=fileRoot+expandedFolder):(expandedFolder="",fullexpandedFolder=null);a("#folder-info").html('<span id="items-counter"></span> '+g.items+" - "+g.size+' : <span id="items-size"></span> '+
g.mb);1==f.options.autoload&&(a("#upload").append(g.upload),a("#newfolder").append(g.new_folder),a("#grid").attr("title",g.grid_view),a("#list").attr("title",g.list_view),a("#fileinfo h1").append(g.select_from_left),a('#itemOptions a[href$="#select"]').append(g.select),a('#itemOptions a[href$="#download"]').append(g.download),a('#itemOptions a[href$="#rename"]').append(g.rename),a('#itemOptions a[href$="#move"]').append(g.move),a('#itemOptions a[href$="#replace"]').append(g.replace),a('#itemOptions a[href$="#delete"]').append(g.del));
a.urlParam("CKEditorCleanUpFuncNum")&&(a("body").append('<button id="close-btn" type="button">'+g.close+"</button>"),a("#close-btn").click(function(){parent.CKEDITOR.tools.callFunction(a.urlParam("CKEditorCleanUpFuncNum"))}));a("#browse").append("+");a("#browse").attr("title",g.browse);a("#newfile").change(function(){a("#filepath").val(a(this).val().replace(/.+[\\\/]/,""))});!0===f.options.searchBox?loadJS("./scripts/filemanager.liveSearch.min.js"):a("#search").remove();a("button").wrapInner("<span></span>");
a("#fileinfo").data("view",f.options.defaultViewMode);B(f.options.defaultViewMode);a("#home").click(function(){var b=a("#fileinfo").data("view");a("#fileinfo").data("view",b);a("#filetree ul.jqueryFileTree > li.expanded > a").trigger("click");m(fileRoot)});a("#level-up").click(function(){var b=a("#uploader h1").attr("data-path");if(b!=fileRoot){var d=b.substring(0,b.slice(0,-1).lastIndexOf("/"))+"/",f=a("#fileinfo").data("view");a("#fileinfo").data("view",f);a("#filetree").find('a[data-path="'+b+
'"]').click();m(d)}});a("#grid").click(function(){B("grid");a("#fileinfo").data("view","grid");m(a("#currentpath").val())});a("#list").click(function(){B("list");a("#fileinfo").data("view","list");m(a("#currentpath").val())});D(fileRoot);f.upload.multiple?(loadCSS("./scripts/dropzone/downloads/css/dropzone.css"),loadJS("./scripts/dropzone/downloads/dropzone.js"),Dropzone.autoDiscover=!1,a("#file-input-container").remove(),a("#upload").remove(),a("#newfolder").before('<button value="Upload" type="button" name="upload" id="upload" class="em"><span>'+
g.upload+"</span></button> "),a("#upload").unbind().click(function(){var b='<div id="dropzone-container"><h2>'+g.current_folder+a("#uploader h1").attr("title")+'</h2><div id="multiple-uploads" class="dropzone"></div>',b=b+'<div id="total-progress"><div data-dz-uploadprogress="" style="width:0%;" class="progress-bar"></div></div>'+('<div class="prompt-info">'+g.dz_dictMaxFilesExceeded.replace("%s",f.upload.number)+g.file_size_limit+f.upload.fileSizeLimit+" "+g.mb+".</div>"),b=b+('<button id="process-upload">'+
g.upload+"</button></div>");error_flag=!1;var d=a("#currentpath").val(),e="auto"!=f.upload.fileSizeLimit?f.upload.fileSizeLimit:256,h="DISALLOW_ALL"==f.security.uploadPolicy?"."+f.security.uploadRestrictions.join(",."):null;if("images"==a.urlParam("type").toString().toLowerCase()||f.upload.imagesOnly)h="."+f.images.imagesExt.join(",.");var l={};l[g.close]=!1;a.prompt(b,{buttons:l});a("div#multiple-uploads").dropzone({paramName:"newfile",url:k+"?config="+userconfig,maxFilesize:e,maxFiles:f.upload.number,
addRemoveLinks:!0,parallelUploads:f.upload.number,dictCancelUpload:g.cancel,dictRemoveFile:g.del,dictMaxFilesExceeded:g.dz_dictMaxFilesExceeded.replace("%s",f.upload.number),dictDefaultMessage:g.dz_dictDefaultMessage,dictInvalidFileType:g.dz_dictInvalidFileType,dictFileTooBig:g.file_too_big+" "+g.file_size_limit+f.upload.fileSizeLimit+" "+g.mb,acceptedFiles:h,autoProcessQueue:!1,init:function(){var b=this;a("#process-upload").click(function(){b.processQueue()})},totaluploadprogress:function(b){a("#total-progress .progress-bar").css("width",
b+"%")},sending:function(a,b,c){c.append("mode","add");c.append("currentpath",d)},success:function(b,c){a("#uploadresponse").empty().html(c);var f=jQuery.parseJSON(a("#uploadresponse").find("textarea").text());0==f.Code?this.removeFile(b):(m(d),a("#filetree").find('a[data-path="'+d+'"]').click(),a.prompt(f.Error),error_flag=!0)},complete:function(b){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&(a("#total-progress .progress-bar").css("width","0%"),0===this.getRejectedFiles().length&&
!1===error_flag&&setTimeout(function(){a.prompt.close()},800),m(d),d==fileRoot&&v(),a("#filetree").find('a[data-path="'+d+'"]').click().click(),f.options.showConfirmation&&a.prompt(g.successful_added_file))}})})):(a("#uploader").attr("action",k+"?config="+userconfig),a("#uploader").ajaxForm({target:"#uploadresponse",beforeSubmit:function(b,d,e){if(""==a("#newfile",d).val())return!1;if(!K(a("#newfile",d).val()))return d="<p>"+g.INVALID_FILE_TYPE+"</p>","DISALLOW_ALL"==f.security.uploadPolicy&&(d+=
"<p>"+g.ALLOWED_FILE_TYPE+f.security.uploadRestrictions.join(", ")+".</p>"),"ALLOW_ALL"==f.security.uploadPolicy&&(d+="<p>"+g.DISALLOWED_FILE_TYPE+f.security.uploadRestrictions.join(", ")+".</p>"),a("#filepath").val(""),a.prompt(d),!1;a("#upload").attr("disabled",!0);a("#upload span").addClass("loading").text(g.loading_data);if("images"==a.urlParam("type").toString().toLowerCase()){b=a("#newfile",d).val().toLowerCase().split(".");e=!1;for(key in f.images.imagesExt)f.images.imagesExt[key]==b[b.length-
1]&&(e=!0);if(!1===e)return a.prompt(g.UPLOAD_IMAGES_ONLY),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(g.upload),!1}if("undefined"!==typeof FileReader&&"auto"!=typeof f.upload.fileSizeLimit&&a("#newfile",d).get(0).files[0].size>1048576*f.upload.fileSizeLimit)return a.prompt("<p>"+g.file_too_big+"</p><p>"+g.file_size_limit+f.upload.fileSizeLimit+" "+g.mb+".</p>"),a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(g.upload),!1},error:function(b,
d,f){a("#upload").removeAttr("disabled").find("span").removeClass("loading").text(g.upload);a.prompt(g.ERROR_UPLOADING_FILE)},success:function(b){b=jQuery.parseJSON(a("#uploadresponse").find("textarea").text());if(0==b.Code){var d=b.Path,e=b.Name,h=q(e),l=a("#filetree").find('a[data-path="'+d+'"]'),k=l.parent(),e='<li class="file ext_'+h+'"><a data-path="'+d+e+'" href="#" class="">'+e+"</a></li>";k.find("ul").size()?(k.find("ul").prepend(e),l.click().click()):(k=a("#filetree").find("ul.jqueryFileTree"),
k.prepend(e),v());m(d);f.options.showConfirmation&&a.prompt(g.successful_added_file);a("#filepath, #newfile").val("");a.browser.msie&&a("#newfile").replaceWith(a("#newfile").clone(!0));a("#filetree").find('a[data-path="'+b.Path+'/"]').click().click()}else a.prompt(b.Error);a("#upload").removeAttr("disabled");a("#upload span").removeClass("loading").text(g.upload);a("#filepath").val("")}}));if(f.customScrollbar.enabled){loadCSS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css");loadJS("./scripts/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js");
var e=void 0!=f.customScrollbar.theme?f.customScrollbar.theme:"inset-2-dark",d=void 0!=f.customScrollbar.button?f.customScrollbar.button:!0;a(window).load(function(){a("#filetree").append('<div style="height:3000px"></div>');a("#filetree").mCustomScrollbar({theme:e,scrollButtons:{enable:d},advanced:{autoExpandHorizontalScroll:!0,updateOnContentResize:!0},callbacks:{onInit:function(){v()}},axis:"yx"});a("#fileinfo").mCustomScrollbar({theme:e,scrollButtons:{enable:d},advanced:{autoExpandHorizontalScroll:!0,
updateOnContentResize:!0},axis:"y",alwaysShowScrollbar:1})})}else v();window.opener||window.tinyMCEPopup||a.urlParam("field_name")||a('#itemOptions a[href$="#select"]').remove();1==f.options.browseOnly&&(a("#file-input-container").remove(),a("#upload").remove(),a("#newfolder").remove(),a("#toolbar").remove("#rename"),a(".contextMenu .rename").remove(),a(".contextMenu .move").remove(),a(".contextMenu .replace").remove(),a(".contextMenu .delete").remove());y();a(window).resize(y);a("#splitter").splitter({sizeLeft:f.options.splitterMinWidth,
minLeft:f.options.splitterMinWidth,minRight:200});G(fileRoot+expandedFolder)});document.documentElement.setAttribute("data-useragent",navigator.userAgent);f.options.logger&&(t=(new Date).getTime(),console.log("Total execution time : "+(t-R)+" ms"));a(window).load(function(){y()})})(jQuery);$(window).load(function(){$("#fileinfo").css({left:$("#splitter .vsplitbar").width()+$("#filetree").width()})});
